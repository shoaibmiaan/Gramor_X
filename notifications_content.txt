File: ./components/design-system/NotificationBell.tsx
import * as React from 'react'
import Link from 'next/link'
import { BellIcon } from '@/lib/icons'
import { useNotifications } from '@/components/notifications/NotificationProvider'

export const NotificationBell: React.FC = () => {
  const [open, setOpen] = React.useState(false)
  const { notifications, unread, markRead } = useNotifications()
  const buttonRef = React.useRef<HTMLButtonElement|null>(null)
  const popoverRef = React.useRef<HTMLDivElement|null>(null)
  const itemsRef = React.useRef<Array<HTMLAnchorElement|HTMLButtonElement|null>>([])

  React.useEffect(()=>{ if(!open) return
    const onDocClick=(e:MouseEvent)=>{ const t=e.target as Node; if(buttonRef.current?.contains(t)) return; if(popoverRef.current?.contains(t)) return; setOpen(false) }
    const onKey=(e:KeyboardEvent)=>{ if(e.key==='Escape'){ setOpen(false); buttonRef.current?.focus() } }
    document.addEventListener('mousedown',onDocClick); document.addEventListener('keydown',onKey)
    return ()=>{ document.removeEventListener('mousedown',onDocClick); document.removeEventListener('keydown',onKey) }
  },[open])

  React.useEffect(()=>{ if(!open) return
    const focusable = itemsRef.current.filter(Boolean) as HTMLElement[]; if(focusable[0]) focusable[0].focus()
    const onKey=(e:KeyboardEvent)=>{ if(!popoverRef.current?.contains(document.activeElement)) return
      const idx = focusable.indexOf(document.activeElement as HTMLElement)
      if(e.key==='ArrowDown'){ e.preventDefault(); focusable[(idx+1)%focusable.length]?.focus() }
      else if(e.key==='ArrowUp'){ e.preventDefault(); focusable[(idx-1+focusable.length)%focusable.length]?.focus() }
      else if(e.key==='Enter' && document.activeElement instanceof HTMLElement){ (document.activeElement as HTMLElement).click() }
    }
    document.addEventListener('keydown',onKey); return ()=>document.removeEventListener('keydown',onKey)
  },[open,notifications])

  const markAllAsRead = async ()=>{ await Promise.all(notifications.filter(n=>!n.read_at).map(n=>markRead(n.id))) }

  return (
    <div className="relative">
      <button ref={buttonRef} type="button" aria-label="Notifications" aria-haspopup="menu" aria-expanded={open} aria-controls="notification-menu"
        onClick={()=>setOpen(v=>!v)}
        className="relative inline-flex h-10 w-10 items-center justify-center rounded-lg hover:bg-muted focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background">
        <BellIcon className="h-5 w-5" aria-hidden="true"/>
        {unread>0 && <span aria-live="polite" className="absolute -top-1 -right-1 flex h-4 min-w-[1rem] items-center justify-center rounded-full bg-sunsetRed px-1 text-[10px] leading-none text-foreground">{unread}</span>}
      </button>

      {open && (
        <div ref={popoverRef} className="absolute right-0 mt-2 w-80 rounded-ds-2xl border border-border bg-card text-card-foreground shadow-lg z-50">
          <div className="flex items-center justify-between border-b border-border px-3 py-2">
            <span className="text-small font-semibold">Notifications</span>
            {unread>0 && (
              <button onClick={markAllAsRead}
                className="text-caption text-foreground/70 hover:text-foreground focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background rounded-ds px-1.5 py-0.5">
                Mark all as read
              </button>
            )}
          </div>
          <ul id="notification-menu" role="menu" className="max-h-72 overflow-auto text-small">
            {notifications.map((n,i)=>{
              const isInternal = n.url?.startsWith('/')
              const common = 'flex items-start gap-2 px-3 py-2 hover:bg-muted/60 focus:bg-muted/60 rounded-none'
              const row =
                <div className={n.read_at?'opacity-60':'' + ''}>
                  <div className="font-medium">{n.title}</div>
                  {n.body && <div className="text-small text-muted-foreground">{n.body}</div>}
                </div>
              return (
                <li key={n.id} role="none">
                  {n.url ? (isInternal ? (
                    <Link href={n.url} role="menuitem" ref={el=>itemsRef.current[i]=el as any} className={common}
                      onClick={()=>{ markRead(n.id); setOpen(false) }}>{row}</Link>
                  ) : (
                    <a href={n.url!} target="_blank" rel="noreferrer" role="menuitem" ref={el=>itemsRef.current[i]=el as any}
                       className={common} onClick={()=>{ markRead(n.id); setOpen(false) }}>{row}</a>
                  )) : (
                    <button role="menuitem" ref={el=>itemsRef.current[i]=el as any}
                      className={common + ' w-full text-left'} onClick={()=>markRead(n.id)}>{row}</button>
                  )}
                </li>
              )
            })}
            {notifications.length===0 && <li className="px-3 py-3 text-muted-foreground">No notifications</li>}
          </ul>
        </div>
      )}
    </div>
  )
}
export default NotificationBell


File: ./components/notifications/NotificationProvider.tsx
import React, {
  createContext,
  useCallback,
  useContext,
  useEffect,
  useMemo,
  useState,
} from 'react';
import { supabaseBrowser } from '@/lib/supabaseBrowser';
import { useToast } from '@/components/design-system/Toaster';
import type { AuthChangeEvent, Session, SupabaseClient } from '@supabase/supabase-js';

export type Notification = {
  id: string;
  title: string | null;
  body: string | null;
  read_at: string | null;
  created_at: string;
  url?: string | null;
};

type Ctx = {
  notifications: Notification[];
  unread: number;
  markRead: (id: string) => Promise<void>;
};

const NotificationCtx = createContext<Ctx | null>(null);

export function NotificationProvider({ children }: { children: React.ReactNode }) {
  const [notifications, setNotifications] = useState<Notification[]>([]);
  const [hasSession, setHasSession] = useState(false);
  const toast = useToast();

  // Works whether supabaseBrowser is an instance or a factory
  const supabase = useMemo(() => {
    const maybeFn = supabaseBrowser as unknown as (() => unknown) | object;
    const client = typeof maybeFn === 'function' ? (maybeFn as any)() : (maybeFn as any);
    return client as SupabaseClient;
  }, []);

  // Track auth state (initial + changes). Clear notifications on logout.
  useEffect(() => {
    let cancelled = false;

    (async () => {
      const {
        data: { session },
      } = await supabase.auth.getSession();
      if (!cancelled) setHasSession(!!session);
    })();

    const {
      data: { subscription },
    } = supabase.auth.onAuthStateChange(
      (_event: AuthChangeEvent, session: Session | null) => {
        setHasSession(!!session);
        if (!session) setNotifications([]);
      }
    );

    return () => {
      subscription.unsubscribe(); // ✅ correct cleanup
      cancelled = true;
    };
  }, [supabase]);

  // Initial load (only when logged in)
  useEffect(() => {
    if (!hasSession) return;
    let active = true;

    (async () => {
      try {
        const res = await fetch('/api/notifications');
        if (!res.ok) return;
        const data = await res.json();
        if (active) setNotifications(data.notifications ?? data.items ?? []);
      } catch {
        /* noop */
      }
    })();

    return () => {
      active = false;
    };
  }, [hasSession]);

  // Realtime subscription (only when logged in)
  useEffect(() => {
    if (!hasSession) return;

    const channel = supabase
      .channel('notifications')
      .on(
        'postgres_changes',
        { event: 'INSERT', schema: 'public', table: 'notifications' },
        (payload: { new: Notification }) => { // ✅ typed payload
          const n = payload.new;
          setNotifications((prev) => [n, ...prev]);
          toast.info(n.title ?? 'Notification', n.body ?? undefined);
        }
      )
      .subscribe();

    return () => {
      supabase.removeChannel(channel);
    };
  }, [hasSession, supabase, toast]);

  const markRead = useCallback(async (id: string) => {
    setNotifications((prev) =>
      prev.map((n) => (n.id === id ? { ...n, read_at: new Date().toISOString() } : n))
    );
    try {
      await fetch(`/api/notifications/${id}`, { method: 'PATCH' });
    } catch {
      /* noop */
    }
  }, []);

  const unread = useMemo(() => notifications.filter((n) => !n.read_at).length, [notifications]);

  const value = useMemo(
    () => ({ notifications, unread, markRead }),
    [notifications, unread, markRead]
  );

  return <NotificationCtx.Provider value={value}>{children}</NotificationCtx.Provider>;
}

export function useNotifications() {
  const ctx = useContext(NotificationCtx);
  if (!ctx) throw new Error('useNotifications must be used within <NotificationProvider>');
  return ctx;
}


File: ./.next/server/pages/api/notifications.js
"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/notifications";
exports.ids = ["pages/api/notifications"];
exports.modules = {

/***/ "@supabase/supabase-js":
/*!****************************************!*\
  !*** external "@supabase/supabase-js" ***!
  \****************************************/
/***/ ((module) => {

module.exports = require("@supabase/supabase-js");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "zod":
/*!**********************!*\
  !*** external "zod" ***!
  \**********************/
/***/ ((module) => {

module.exports = import("zod");;

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fnotifications&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fnotifications%2Findex.ts&middlewareConfigBase64=e30%3D!":
/*!****************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fnotifications&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fnotifications%2Findex.ts&middlewareConfigBase64=e30%3D! ***!
  \****************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_notifications_index_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages/api/notifications/index.ts */ \"(api)/./pages/api/notifications/index.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_notifications_index_ts__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_notifications_index_ts__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_notifications_index_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_notifications_index_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/notifications\",\n        pathname: \"/api/notifications\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_notifications_index_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRm5vdGlmaWNhdGlvbnMmcHJlZmVycmVkUmVnaW9uPSZhYnNvbHV0ZVBhZ2VQYXRoPS4lMkZwYWdlcyUyRmFwaSUyRm5vdGlmaWNhdGlvbnMlMkZpbmRleC50cyZtaWRkbGV3YXJlQ29uZmlnQmFzZTY0PWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDTDtBQUMxRDtBQUMrRDtBQUMvRDtBQUNBLGlFQUFlLHdFQUFLLENBQUMsOERBQVEsWUFBWSxFQUFDO0FBQzFDO0FBQ08sZUFBZSx3RUFBSyxDQUFDLDhEQUFRO0FBQ3BDO0FBQ08sd0JBQXdCLGdIQUFtQjtBQUNsRDtBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxZQUFZO0FBQ1osQ0FBQzs7QUFFRCxxQyIsInNvdXJjZXMiOlsid2VicGFjazovL2dyYW1vcl94Lz9hZDQ5Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBhZ2VzQVBJUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgaG9pc3QgfSBmcm9tIFwibmV4dC9kaXN0L2J1aWxkL3RlbXBsYXRlcy9oZWxwZXJzXCI7XG4vLyBJbXBvcnQgdGhlIHVzZXJsYW5kIGNvZGUuXG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiLi9wYWdlcy9hcGkvbm90aWZpY2F0aW9ucy9pbmRleC50c1wiO1xuLy8gUmUtZXhwb3J0IHRoZSBoYW5kbGVyIChzaG91bGQgYmUgdGhlIGRlZmF1bHQgZXhwb3J0KS5cbmV4cG9ydCBkZWZhdWx0IGhvaXN0KHVzZXJsYW5kLCBcImRlZmF1bHRcIik7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCBcImNvbmZpZ1wiKTtcbi8vIENyZWF0ZSBhbmQgZXhwb3J0IHRoZSByb3V0ZSBtb2R1bGUgdGhhdCB3aWxsIGJlIGNvbnN1bWVkLlxuZXhwb3J0IGNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IFBhZ2VzQVBJUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLlBBR0VTX0FQSSxcbiAgICAgICAgcGFnZTogXCIvYXBpL25vdGlmaWNhdGlvbnNcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9ub3RpZmljYXRpb25zXCIsXG4gICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgYXJlbid0IHVzZWQgaW4gcHJvZHVjdGlvbi5cbiAgICAgICAgYnVuZGxlUGF0aDogXCJcIixcbiAgICAgICAgZmlsZW5hbWU6IFwiXCJcbiAgICB9LFxuICAgIHVzZXJsYW5kXG59KTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fnotifications&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fnotifications%2Findex.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./lib/env.ts":
/*!********************!*\
  !*** ./lib/env.ts ***!
  \********************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   bool: () => (/* binding */ bool),\n/* harmony export */   env: () => (/* binding */ env),\n/* harmony export */   isBrowser: () => (/* binding */ isBrowser),\n/* harmony export */   isServer: () => (/* binding */ isServer)\n/* harmony export */ });\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! zod */ \"zod\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([zod__WEBPACK_IMPORTED_MODULE_0__]);\nzod__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n// lib/env.ts\n\nconst envSchema = zod__WEBPACK_IMPORTED_MODULE_0__.z.object({\n    // Public (client) vars\n    NEXT_PUBLIC_SUPABASE_URL: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().url(),\n    NEXT_PUBLIC_SUPABASE_ANON_KEY: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().min(1),\n    NEXT_PUBLIC_BASE_URL: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().url().optional(),\n    NEXT_PUBLIC_IDLE_TIMEOUT_MINUTES: zod__WEBPACK_IMPORTED_MODULE_0__.z.coerce.number().default(30),\n    NEXT_PUBLIC_DEBUG: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    NEXT_PUBLIC_SITE_URL: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().url().optional(),\n    // Feature flags (client)\n    NEXT_PUBLIC_FEATURE_TRIAL: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    NEXT_PUBLIC_FEATURE_PAYWALL: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    NEXT_PUBLIC_FEATURE_REFERRAL: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    NEXT_PUBLIC_FEATURE_PARTNER: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    NEXT_PUBLIC_FEATURE_PREDICTOR: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    NEXT_PUBLIC_FEATURE_CHALLENGE: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    // Optional analytics/monitoring\n    NEXT_PUBLIC_GA4_ID: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    NEXT_PUBLIC_META_PIXEL_ID: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    NEXT_PUBLIC_SENTRY_DSN: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    // Optional client-side toggles/util\n    NEXT_PUBLIC_TWILIO_BYPASS: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    NEXT_PUBLIC_PAYMENTS_PROVIDER: zod__WEBPACK_IMPORTED_MODULE_0__.z.enum([\n        \"none\",\n        \"stripe\",\n        \"easypaisa\",\n        \"jazzcash\"\n    ]).optional(),\n    // Server-only vars (required)\n    SUPABASE_URL: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().url(),\n    SUPABASE_SERVICE_KEY: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().min(1),\n    SUPABASE_SERVICE_ROLE_KEY: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().min(1),\n    ADMIN_EMAILS: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    GOOGLE_GENERATIVE_AI_API_KEY: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    GROQ_API_KEY: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    GROQ_MODEL: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    OPENAI_API_KEY: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    OPENAI_MODEL: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    GEMINI_API_KEY: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    GEMINI_MODEL: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    GX_AI_PROVIDER: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    PREMIUM_MASTER_PIN: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    PREMIUM_PIN_HASH: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    PREMIUM_PIN_SALT: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    PREMIUM_PIN_RATE: zod__WEBPACK_IMPORTED_MODULE_0__.z.coerce.number().optional(),\n    PREMIUM_PIN_WINDOW_SEC: zod__WEBPACK_IMPORTED_MODULE_0__.z.coerce.number().optional(),\n    STRIPE_SECRET_KEY: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    STRIPE_WEBHOOK_SECRET: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    STRIPE_PRICE_STARTER_MONTHLY: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    STRIPE_PRICE_STARTER_ANNUAL: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    STRIPE_PRICE_BOOSTER_MONTHLY: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    STRIPE_PRICE_BOOSTER_ANNUAL: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    STRIPE_PRICE_MASTER_MONTHLY: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    STRIPE_PRICE_MASTER_ANNUAL: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    SPEAKING_DAILY_LIMIT: zod__WEBPACK_IMPORTED_MODULE_0__.z.coerce.number().optional(),\n    SPEAKING_BUCKET: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    TWILIO_ACCOUNT_SID: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().min(1),\n    TWILIO_AUTH_TOKEN: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().min(1),\n    TWILIO_VERIFY_SERVICE_SID: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().min(1),\n    TWILIO_WHATSAPP_FROM: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().min(1),\n    TWILIO_BYPASS: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    NEXT_PUBLIC_DEV_PAYMENTS: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    EASYPASA_MERCHANT_ID: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    EASYPASA_SECRET: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    JAZZCASH_MERCHANT_ID: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    JAZZCASH_INTEGRITY_SALT: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    LOCAL_ADMIN_TOKEN: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    ADMIN_API_TOKEN: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().optional(),\n    SITE_URL: zod__WEBPACK_IMPORTED_MODULE_0__.z.string().url().optional(),\n    PAYMENTS_PROVIDER: zod__WEBPACK_IMPORTED_MODULE_0__.z.enum([\n        \"none\",\n        \"stripe\",\n        \"easypaisa\",\n        \"jazzcash\"\n    ]).optional(),\n    PORT: zod__WEBPACK_IMPORTED_MODULE_0__.z.coerce.number().optional(),\n    NODE_ENV: zod__WEBPACK_IMPORTED_MODULE_0__.z.enum([\n        \"development\",\n        \"production\",\n        \"test\"\n    ]).default(\"development\")\n});\nconst raw = {\n    NEXT_PUBLIC_SUPABASE_URL: \"https://xypbinamxunmwkhlvefd.supabase.co\",\n    NEXT_PUBLIC_SUPABASE_ANON_KEY: \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh5cGJpbmFteHVubXdraGx2ZWZkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkyNTQyNjEsImV4cCI6MjA2NDgzMDI2MX0.1Iiey5VPWsDhiziMM7-HBg5RIz4RC9crW1pL8oDeLzw\",\n    NEXT_PUBLIC_BASE_URL: \"http://localhost:3000\",\n    NEXT_PUBLIC_IDLE_TIMEOUT_MINUTES: process.env.NEXT_PUBLIC_IDLE_TIMEOUT_MINUTES,\n    NEXT_PUBLIC_DEBUG: \"1\",\n    NEXT_PUBLIC_SITE_URL: \"http://localhost:3000\",\n    NEXT_PUBLIC_FEATURE_TRIAL: process.env.NEXT_PUBLIC_FEATURE_TRIAL,\n    NEXT_PUBLIC_FEATURE_PAYWALL: process.env.NEXT_PUBLIC_FEATURE_PAYWALL,\n    NEXT_PUBLIC_FEATURE_REFERRAL: process.env.NEXT_PUBLIC_FEATURE_REFERRAL,\n    NEXT_PUBLIC_FEATURE_PARTNER: process.env.NEXT_PUBLIC_FEATURE_PARTNER,\n    NEXT_PUBLIC_FEATURE_PREDICTOR: process.env.NEXT_PUBLIC_FEATURE_PREDICTOR,\n    NEXT_PUBLIC_FEATURE_CHALLENGE: process.env.NEXT_PUBLIC_FEATURE_CHALLENGE,\n    NEXT_PUBLIC_GA4_ID: process.env.NEXT_PUBLIC_GA4_ID,\n    NEXT_PUBLIC_META_PIXEL_ID: process.env.NEXT_PUBLIC_META_PIXEL_ID,\n    NEXT_PUBLIC_SENTRY_DSN: process.env.NEXT_PUBLIC_SENTRY_DSN,\n    NEXT_PUBLIC_TWILIO_BYPASS: process.env.NEXT_PUBLIC_TWILIO_BYPASS,\n    NEXT_PUBLIC_PAYMENTS_PROVIDER: process.env.NEXT_PUBLIC_PAYMENTS_PROVIDER,\n    SUPABASE_URL: process.env.SUPABASE_URL,\n    SUPABASE_SERVICE_KEY: process.env.SUPABASE_SERVICE_KEY,\n    SUPABASE_SERVICE_ROLE_KEY: process.env.SUPABASE_SERVICE_ROLE_KEY,\n    ADMIN_EMAILS: process.env.ADMIN_EMAILS,\n    GOOGLE_GENERATIVE_AI_API_KEY: process.env.GOOGLE_GENERATIVE_AI_API_KEY,\n    GROQ_API_KEY: process.env.GROQ_API_KEY,\n    GROQ_MODEL: process.env.GROQ_MODEL,\n    OPENAI_API_KEY: process.env.OPENAI_API_KEY,\n    OPENAI_MODEL: process.env.OPENAI_MODEL,\n    GEMINI_API_KEY: process.env.GEMINI_API_KEY,\n    GEMINI_MODEL: process.env.GEMINI_MODEL,\n    GX_AI_PROVIDER: process.env.GX_AI_PROVIDER,\n    PREMIUM_MASTER_PIN: process.env.PREMIUM_MASTER_PIN,\n    PREMIUM_PIN_HASH: process.env.PREMIUM_PIN_HASH,\n    PREMIUM_PIN_SALT: process.env.PREMIUM_PIN_SALT,\n    PREMIUM_PIN_RATE: process.env.PREMIUM_PIN_RATE,\n    PREMIUM_PIN_WINDOW_SEC: process.env.PREMIUM_PIN_WINDOW_SEC,\n    STRIPE_SECRET_KEY: process.env.STRIPE_SECRET_KEY,\n    STRIPE_WEBHOOK_SECRET: process.env.STRIPE_WEBHOOK_SECRET,\n    STRIPE_PRICE_STARTER_MONTHLY: process.env.STRIPE_PRICE_STARTER_MONTHLY,\n    STRIPE_PRICE_STARTER_ANNUAL: process.env.STRIPE_PRICE_STARTER_ANNUAL,\n    STRIPE_PRICE_BOOSTER_MONTHLY: process.env.STRIPE_PRICE_BOOSTER_MONTHLY,\n    STRIPE_PRICE_BOOSTER_ANNUAL: process.env.STRIPE_PRICE_BOOSTER_ANNUAL,\n    STRIPE_PRICE_MASTER_MONTHLY: process.env.STRIPE_PRICE_MASTER_MONTHLY,\n    STRIPE_PRICE_MASTER_ANNUAL: process.env.STRIPE_PRICE_MASTER_ANNUAL,\n    SPEAKING_DAILY_LIMIT: process.env.SPEAKING_DAILY_LIMIT,\n    SPEAKING_BUCKET: process.env.SPEAKING_BUCKET,\n    TWILIO_ACCOUNT_SID: process.env.TWILIO_ACCOUNT_SID,\n    TWILIO_AUTH_TOKEN: process.env.TWILIO_AUTH_TOKEN,\n    TWILIO_VERIFY_SERVICE_SID: process.env.TWILIO_VERIFY_SERVICE_SID,\n    TWILIO_WHATSAPP_FROM: process.env.TWILIO_WHATSAPP_FROM,\n    TWILIO_BYPASS: process.env.TWILIO_BYPASS,\n    NEXT_PUBLIC_DEV_PAYMENTS: process.env.NEXT_PUBLIC_DEV_PAYMENTS,\n    EASYPASA_MERCHANT_ID: process.env.EASYPASA_MERCHANT_ID,\n    EASYPASA_SECRET: process.env.EASYPASA_SECRET,\n    JAZZCASH_MERCHANT_ID: process.env.JAZZCASH_MERCHANT_ID,\n    JAZZCASH_INTEGRITY_SALT: process.env.JAZZCASH_INTEGRITY_SALT,\n    LOCAL_ADMIN_TOKEN: process.env.LOCAL_ADMIN_TOKEN,\n    ADMIN_API_TOKEN: process.env.ADMIN_API_TOKEN,\n    SITE_URL: process.env.SITE_URL,\n    PAYMENTS_PROVIDER: process.env.PAYMENTS_PROVIDER,\n    PORT: process.env.PORT,\n    NODE_ENV: \"development\"\n};\nconst skipValidation = process.env.SKIP_ENV_VALIDATION === \"true\" || raw.NODE_ENV === \"test\";\n// Vercel sets VERCEL_ENV to 'development' | 'preview' | 'production'\nconst isProdBuild = raw.NODE_ENV === \"production\" && process.env.VERCEL_ENV === \"production\";\nconst parsed = envSchema.safeParse(raw);\nif (!parsed.success && \"undefined\" === \"undefined\") {\n    if (skipValidation || !isProdBuild) {\n        const warnings = parsed.error.issues.map((i)=>`${i.path.join(\".\")}: ${i.message}`).join(\"\\n\");\n        console.warn(\"Skipping strict environment validation (non-prod or SKIP_ENV_VALIDATION=true). Falling back to safe defaults:\\n\" + warnings);\n    } else {\n        const errors = parsed.error.issues.map((i)=>`${i.path.join(\".\")}: ${i.message}`).join(\"\\n\");\n        console.error(\"Invalid environment variables:\\n\" + errors);\n        throw new Error(\"Invalid environment variables\");\n    }\n}\nconst defaults = {\n    NEXT_PUBLIC_SUPABASE_URL: \"http://localhost:54321\",\n    NEXT_PUBLIC_SUPABASE_ANON_KEY: \"anon_key\",\n    SUPABASE_URL: \"http://localhost:54321\",\n    SUPABASE_SERVICE_KEY: \"service_key\",\n    SUPABASE_SERVICE_ROLE_KEY: \"service_role_key\",\n    TWILIO_ACCOUNT_SID: \"ACXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\",\n    TWILIO_AUTH_TOKEN: \"auth_token\",\n    TWILIO_VERIFY_SERVICE_SID: \"VAXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX\",\n    TWILIO_WHATSAPP_FROM: \"whatsapp:+10000000000\",\n    PAYMENTS_PROVIDER: \"none\",\n    NEXT_PUBLIC_PAYMENTS_PROVIDER: \"none\"\n};\nconst env = parsed.success ? parsed.data : {\n    ...defaults,\n    ...raw,\n    NEXT_PUBLIC_IDLE_TIMEOUT_MINUTES: Number(raw.NEXT_PUBLIC_IDLE_TIMEOUT_MINUTES ?? 30)\n};\nconst isBrowser = \"undefined\" !== \"undefined\";\nconst isServer = !isBrowser;\nfunction bool(val, fallback = false) {\n    if (val == null) return fallback;\n    return [\n        \"1\",\n        \"true\",\n        \"yes\",\n        \"on\"\n    ].includes(String(val).toLowerCase());\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QyxNQUFPSyxPQUFPRSxPQUFPLEdBQzlCRixPQUFPZ0IsSUFBSSxHQUNYO0lBQ0UsR0FBR0QsUUFBUTtJQUNYLEdBQUd0QixHQUFHO0lBQ043RCxrQ0FBa0NxRixPQUNoQ3hCLElBQUk3RCxnQ0FBZ0MsSUFBSTtBQUU1QyxFQUFHO0FBRUEsTUFBTXNGLFlBQVksZ0JBQWtCLFlBQVk7QUFDaEQsTUFBTUMsV0FBVyxDQUFDRCxVQUFVO0FBQzVCLFNBQVNFLEtBQUtDLEdBQVksRUFBRUMsV0FBVyxLQUFLO0lBQ2pELElBQUlELE9BQU8sTUFBTSxPQUFPQztJQUN4QixPQUFPO1FBQUM7UUFBSztRQUFRO1FBQU87S0FBSyxDQUFDQyxRQUFRLENBQUNDLE9BQU9ILEtBQUtJLFdBQVc7QUFDcEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9ncmFtb3JfeC8uL2xpYi9lbnYudHM/OTNmMiJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBsaWIvZW52LnRzXG5pbXBvcnQgeyB6IH0gZnJvbSAnem9kJztcblxuY29uc3QgZW52U2NoZW1hID0gei5vYmplY3Qoe1xuICAvLyBQdWJsaWMgKGNsaWVudCkgdmFyc1xuICBORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkw6IHouc3RyaW5nKCkudXJsKCksXG4gIE5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZOiB6LnN0cmluZygpLm1pbigxKSxcbiAgTkVYVF9QVUJMSUNfQkFTRV9VUkw6IHouc3RyaW5nKCkudXJsKCkub3B0aW9uYWwoKSxcbiAgTkVYVF9QVUJMSUNfSURMRV9USU1FT1VUX01JTlVURVM6IHouY29lcmNlLm51bWJlcigpLmRlZmF1bHQoMzApLFxuICBORVhUX1BVQkxJQ19ERUJVRzogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBORVhUX1BVQkxJQ19TSVRFX1VSTDogei5zdHJpbmcoKS51cmwoKS5vcHRpb25hbCgpLFxuXG4gIC8vIEZlYXR1cmUgZmxhZ3MgKGNsaWVudClcbiAgTkVYVF9QVUJMSUNfRkVBVFVSRV9UUklBTDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBORVhUX1BVQkxJQ19GRUFUVVJFX1BBWVdBTEw6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgTkVYVF9QVUJMSUNfRkVBVFVSRV9SRUZFUlJBTDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBORVhUX1BVQkxJQ19GRUFUVVJFX1BBUlRORVI6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgTkVYVF9QVUJMSUNfRkVBVFVSRV9QUkVESUNUT1I6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgTkVYVF9QVUJMSUNfRkVBVFVSRV9DSEFMTEVOR0U6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcblxuICAvLyBPcHRpb25hbCBhbmFseXRpY3MvbW9uaXRvcmluZ1xuICBORVhUX1BVQkxJQ19HQTRfSUQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgTkVYVF9QVUJMSUNfTUVUQV9QSVhFTF9JRDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBORVhUX1BVQkxJQ19TRU5UUllfRFNOOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cbiAgLy8gT3B0aW9uYWwgY2xpZW50LXNpZGUgdG9nZ2xlcy91dGlsXG4gIE5FWFRfUFVCTElDX1RXSUxJT19CWVBBU1M6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgTkVYVF9QVUJMSUNfUEFZTUVOVFNfUFJPVklERVI6IHpcbiAgICAuZW51bShbJ25vbmUnLCAnc3RyaXBlJywgJ2Vhc3lwYWlzYScsICdqYXp6Y2FzaCddKVxuICAgIC5vcHRpb25hbCgpLFxuXG4gIC8vIFNlcnZlci1vbmx5IHZhcnMgKHJlcXVpcmVkKVxuICBTVVBBQkFTRV9VUkw6IHouc3RyaW5nKCkudXJsKCksXG4gIFNVUEFCQVNFX1NFUlZJQ0VfS0VZOiB6LnN0cmluZygpLm1pbigxKSxcbiAgU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWTogei5zdHJpbmcoKS5taW4oMSksXG5cbiAgQURNSU5fRU1BSUxTOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cbiAgR09PR0xFX0dFTkVSQVRJVkVfQUlfQVBJX0tFWTogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBHUk9RX0FQSV9LRVk6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgR1JPUV9NT0RFTDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBPUEVOQUlfQVBJX0tFWTogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBPUEVOQUlfTU9ERUw6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgR0VNSU5JX0FQSV9LRVk6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgR0VNSU5JX01PREVMOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIEdYX0FJX1BST1ZJREVSOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cbiAgUFJFTUlVTV9NQVNURVJfUElOOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIFBSRU1JVU1fUElOX0hBU0g6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgUFJFTUlVTV9QSU5fU0FMVDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBQUkVNSVVNX1BJTl9SQVRFOiB6LmNvZXJjZS5udW1iZXIoKS5vcHRpb25hbCgpLFxuICBQUkVNSVVNX1BJTl9XSU5ET1dfU0VDOiB6LmNvZXJjZS5udW1iZXIoKS5vcHRpb25hbCgpLFxuXG4gIFNUUklQRV9TRUNSRVRfS0VZOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIFNUUklQRV9XRUJIT09LX1NFQ1JFVDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBTVFJJUEVfUFJJQ0VfU1RBUlRFUl9NT05USExZOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIFNUUklQRV9QUklDRV9TVEFSVEVSX0FOTlVBTDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBTVFJJUEVfUFJJQ0VfQk9PU1RFUl9NT05USExZOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIFNUUklQRV9QUklDRV9CT09TVEVSX0FOTlVBTDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBTVFJJUEVfUFJJQ0VfTUFTVEVSX01PTlRITFk6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgU1RSSVBFX1BSSUNFX01BU1RFUl9BTk5VQUw6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcblxuICBTUEVBS0lOR19EQUlMWV9MSU1JVDogei5jb2VyY2UubnVtYmVyKCkub3B0aW9uYWwoKSxcbiAgU1BFQUtJTkdfQlVDS0VUOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cbiAgVFdJTElPX0FDQ09VTlRfU0lEOiB6LnN0cmluZygpLm1pbigxKSxcbiAgVFdJTElPX0FVVEhfVE9LRU46IHouc3RyaW5nKCkubWluKDEpLFxuICBUV0lMSU9fVkVSSUZZX1NFUlZJQ0VfU0lEOiB6LnN0cmluZygpLm1pbigxKSxcbiAgVFdJTElPX1dIQVRTQVBQX0ZST006IHouc3RyaW5nKCkubWluKDEpLFxuICBUV0lMSU9fQllQQVNTOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG5cbiAgTkVYVF9QVUJMSUNfREVWX1BBWU1FTlRTOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIEVBU1lQQVNBX01FUkNIQU5UX0lEOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIEVBU1lQQVNBX1NFQ1JFVDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBKQVpaQ0FTSF9NRVJDSEFOVF9JRDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBKQVpaQ0FTSF9JTlRFR1JJVFlfU0FMVDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuXG4gIExPQ0FMX0FETUlOX1RPS0VOOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIEFETUlOX0FQSV9UT0tFTjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBTSVRFX1VSTDogei5zdHJpbmcoKS51cmwoKS5vcHRpb25hbCgpLFxuICBQQVlNRU5UU19QUk9WSURFUjogei5lbnVtKFsnbm9uZScsICdzdHJpcGUnLCAnZWFzeXBhaXNhJywgJ2phenpjYXNoJ10pLm9wdGlvbmFsKCksXG4gIFBPUlQ6IHouY29lcmNlLm51bWJlcigpLm9wdGlvbmFsKCksXG4gIE5PREVfRU5WOiB6LmVudW0oWydkZXZlbG9wbWVudCcsICdwcm9kdWN0aW9uJywgJ3Rlc3QnXSkuZGVmYXVsdCgnZGV2ZWxvcG1lbnQnKSxcbn0pO1xuXG5jb25zdCByYXcgPSB7XG4gIE5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTDogcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMLFxuICBORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWTogcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVksXG4gIE5FWFRfUFVCTElDX0JBU0VfVVJMOiBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19CQVNFX1VSTCxcbiAgTkVYVF9QVUJMSUNfSURMRV9USU1FT1VUX01JTlVURVM6IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0lETEVfVElNRU9VVF9NSU5VVEVTLFxuICBORVhUX1BVQkxJQ19ERUJVRzogcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfREVCVUcsXG4gIE5FWFRfUFVCTElDX1NJVEVfVVJMOiBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TSVRFX1VSTCxcblxuICBORVhUX1BVQkxJQ19GRUFUVVJFX1RSSUFMOiBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19GRUFUVVJFX1RSSUFMLFxuICBORVhUX1BVQkxJQ19GRUFUVVJFX1BBWVdBTEw6IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0ZFQVRVUkVfUEFZV0FMTCxcbiAgTkVYVF9QVUJMSUNfRkVBVFVSRV9SRUZFUlJBTDogcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfRkVBVFVSRV9SRUZFUlJBTCxcbiAgTkVYVF9QVUJMSUNfRkVBVFVSRV9QQVJUTkVSOiBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19GRUFUVVJFX1BBUlRORVIsXG4gIE5FWFRfUFVCTElDX0ZFQVRVUkVfUFJFRElDVE9SOiBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19GRUFUVVJFX1BSRURJQ1RPUixcbiAgTkVYVF9QVUJMSUNfRkVBVFVSRV9DSEFMTEVOR0U6IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0ZFQVRVUkVfQ0hBTExFTkdFLFxuXG4gIE5FWFRfUFVCTElDX0dBNF9JRDogcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfR0E0X0lELFxuICBORVhUX1BVQkxJQ19NRVRBX1BJWEVMX0lEOiBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19NRVRBX1BJWEVMX0lELFxuICBORVhUX1BVQkxJQ19TRU5UUllfRFNOOiBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TRU5UUllfRFNOLFxuXG4gIE5FWFRfUFVCTElDX1RXSUxJT19CWVBBU1M6IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1RXSUxJT19CWVBBU1MsXG4gIE5FWFRfUFVCTElDX1BBWU1FTlRTX1BST1ZJREVSOiBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19QQVlNRU5UU19QUk9WSURFUixcblxuICBTVVBBQkFTRV9VUkw6IHByb2Nlc3MuZW52LlNVUEFCQVNFX1VSTCxcbiAgU1VQQUJBU0VfU0VSVklDRV9LRVk6IHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfS0VZLFxuICBTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZOiBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZLFxuXG4gIEFETUlOX0VNQUlMUzogcHJvY2Vzcy5lbnYuQURNSU5fRU1BSUxTLFxuXG4gIEdPT0dMRV9HRU5FUkFUSVZFX0FJX0FQSV9LRVk6IHByb2Nlc3MuZW52LkdPT0dMRV9HRU5FUkFUSVZFX0FJX0FQSV9LRVksXG4gIEdST1FfQVBJX0tFWTogcHJvY2Vzcy5lbnYuR1JPUV9BUElfS0VZLFxuICBHUk9RX01PREVMOiBwcm9jZXNzLmVudi5HUk9RX01PREVMLFxuICBPUEVOQUlfQVBJX0tFWTogcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVksXG4gIE9QRU5BSV9NT0RFTDogcHJvY2Vzcy5lbnYuT1BFTkFJX01PREVMLFxuICBHRU1JTklfQVBJX0tFWTogcHJvY2Vzcy5lbnYuR0VNSU5JX0FQSV9LRVksXG4gIEdFTUlOSV9NT0RFTDogcHJvY2Vzcy5lbnYuR0VNSU5JX01PREVMLFxuICBHWF9BSV9QUk9WSURFUjogcHJvY2Vzcy5lbnYuR1hfQUlfUFJPVklERVIsXG5cbiAgUFJFTUlVTV9NQVNURVJfUElOOiBwcm9jZXNzLmVudi5QUkVNSVVNX01BU1RFUl9QSU4sXG4gIFBSRU1JVU1fUElOX0hBU0g6IHByb2Nlc3MuZW52LlBSRU1JVU1fUElOX0hBU0gsXG4gIFBSRU1JVU1fUElOX1NBTFQ6IHByb2Nlc3MuZW52LlBSRU1JVU1fUElOX1NBTFQsXG4gIFBSRU1JVU1fUElOX1JBVEU6IHByb2Nlc3MuZW52LlBSRU1JVU1fUElOX1JBVEUsXG4gIFBSRU1JVU1fUElOX1dJTkRPV19TRUM6IHByb2Nlc3MuZW52LlBSRU1JVU1fUElOX1dJTkRPV19TRUMsXG5cbiAgU1RSSVBFX1NFQ1JFVF9LRVk6IHByb2Nlc3MuZW52LlNUUklQRV9TRUNSRVRfS0VZLFxuICBTVFJJUEVfV0VCSE9PS19TRUNSRVQ6IHByb2Nlc3MuZW52LlNUUklQRV9XRUJIT09LX1NFQ1JFVCxcbiAgU1RSSVBFX1BSSUNFX1NUQVJURVJfTU9OVEhMWTogcHJvY2Vzcy5lbnYuU1RSSVBFX1BSSUNFX1NUQVJURVJfTU9OVEhMWSxcbiAgU1RSSVBFX1BSSUNFX1NUQVJURVJfQU5OVUFMOiBwcm9jZXNzLmVudi5TVFJJUEVfUFJJQ0VfU1RBUlRFUl9BTk5VQUwsXG4gIFNUUklQRV9QUklDRV9CT09TVEVSX01PTlRITFk6IHByb2Nlc3MuZW52LlNUUklQRV9QUklDRV9CT09TVEVSX01PTlRITFksXG4gIFNUUklQRV9QUklDRV9CT09TVEVSX0FOTlVBTDogcHJvY2Vzcy5lbnYuU1RSSVBFX1BSSUNFX0JPT1NURVJfQU5OVUFMLFxuICBTVFJJUEVfUFJJQ0VfTUFTVEVSX01PTlRITFk6IHByb2Nlc3MuZW52LlNUUklQRV9QUklDRV9NQVNURVJfTU9OVEhMWSxcbiAgU1RSSVBFX1BSSUNFX01BU1RFUl9BTk5VQUw6IHByb2Nlc3MuZW52LlNUUklQRV9QUklDRV9NQVNURVJfQU5OVUFMLFxuXG4gIFNQRUFLSU5HX0RBSUxZX0xJTUlUOiBwcm9jZXNzLmVudi5TUEVBS0lOR19EQUlMWV9MSU1JVCxcbiAgU1BFQUtJTkdfQlVDS0VUOiBwcm9jZXNzLmVudi5TUEVBS0lOR19CVUNLRVQsXG5cbiAgVFdJTElPX0FDQ09VTlRfU0lEOiBwcm9jZXNzLmVudi5UV0lMSU9fQUNDT1VOVF9TSUQsXG4gIFRXSUxJT19BVVRIX1RPS0VOOiBwcm9jZXNzLmVudi5UV0lMSU9fQVVUSF9UT0tFTixcbiAgVFdJTElPX1ZFUklGWV9TRVJWSUNFX1NJRDogcHJvY2Vzcy5lbnYuVFdJTElPX1ZFUklGWV9TRVJWSUNFX1NJRCxcbiAgVFdJTElPX1dIQVRTQVBQX0ZST006IHByb2Nlc3MuZW52LlRXSUxJT19XSEFUU0FQUF9GUk9NLFxuICBUV0lMSU9fQllQQVNTOiBwcm9jZXNzLmVudi5UV0lMSU9fQllQQVNTLFxuXG4gIE5FWFRfUFVCTElDX0RFVl9QQVlNRU5UUzogcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfREVWX1BBWU1FTlRTLFxuICBFQVNZUEFTQV9NRVJDSEFOVF9JRDogcHJvY2Vzcy5lbnYuRUFTWVBBU0FfTUVSQ0hBTlRfSUQsXG4gIEVBU1lQQVNBX1NFQ1JFVDogcHJvY2Vzcy5lbnYuRUFTWVBBU0FfU0VDUkVULFxuICBKQVpaQ0FTSF9NRVJDSEFOVF9JRDogcHJvY2Vzcy5lbnYuSkFaWkNBU0hfTUVSQ0hBTlRfSUQsXG4gIEpBWlpDQVNIX0lOVEVHUklUWV9TQUxUOiBwcm9jZXNzLmVudi5KQVpaQ0FTSF9JTlRFR1JJVFlfU0FMVCxcblxuICBMT0NBTF9BRE1JTl9UT0tFTjogcHJvY2Vzcy5lbnYuTE9DQUxfQURNSU5fVE9LRU4sXG4gIEFETUlOX0FQSV9UT0tFTjogcHJvY2Vzcy5lbnYuQURNSU5fQVBJX1RPS0VOLFxuICBTSVRFX1VSTDogcHJvY2Vzcy5lbnYuU0lURV9VUkwsXG4gIFBBWU1FTlRTX1BST1ZJREVSOiBwcm9jZXNzLmVudi5QQVlNRU5UU19QUk9WSURFUixcbiAgUE9SVDogcHJvY2Vzcy5lbnYuUE9SVCxcbiAgTk9ERV9FTlY6IHByb2Nlc3MuZW52Lk5PREVfRU5WIGFzIGFueSxcbn07XG5cbmNvbnN0IHNraXBWYWxpZGF0aW9uID1cbiAgcHJvY2Vzcy5lbnYuU0tJUF9FTlZfVkFMSURBVElPTiA9PT0gJ3RydWUnIHx8IHJhdy5OT0RFX0VOViA9PT0gJ3Rlc3QnO1xuXG4vLyBWZXJjZWwgc2V0cyBWRVJDRUxfRU5WIHRvICdkZXZlbG9wbWVudCcgfCAncHJldmlldycgfCAncHJvZHVjdGlvbidcbmNvbnN0IGlzUHJvZEJ1aWxkID1cbiAgcmF3Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbicgJiYgcHJvY2Vzcy5lbnYuVkVSQ0VMX0VOViA9PT0gJ3Byb2R1Y3Rpb24nO1xuXG5jb25zdCBwYXJzZWQgPSBlbnZTY2hlbWEuc2FmZVBhcnNlKHJhdyk7XG5cbmlmICghcGFyc2VkLnN1Y2Nlc3MgJiYgdHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgaWYgKHNraXBWYWxpZGF0aW9uIHx8ICFpc1Byb2RCdWlsZCkge1xuICAgIGNvbnN0IHdhcm5pbmdzID0gcGFyc2VkLmVycm9yLmlzc3Vlc1xuICAgICAgLm1hcCgoaSkgPT4gYCR7aS5wYXRoLmpvaW4oJy4nKX06ICR7aS5tZXNzYWdlfWApXG4gICAgICAuam9pbignXFxuJyk7XG4gICAgY29uc29sZS53YXJuKFxuICAgICAgJ1NraXBwaW5nIHN0cmljdCBlbnZpcm9ubWVudCB2YWxpZGF0aW9uIChub24tcHJvZCBvciBTS0lQX0VOVl9WQUxJREFUSU9OPXRydWUpLiBGYWxsaW5nIGJhY2sgdG8gc2FmZSBkZWZhdWx0czpcXG4nICtcbiAgICAgICAgd2FybmluZ3MsXG4gICAgKTtcbiAgfSBlbHNlIHtcbiAgICBjb25zdCBlcnJvcnMgPSBwYXJzZWQuZXJyb3IuaXNzdWVzXG4gICAgICAubWFwKChpKSA9PiBgJHtpLnBhdGguam9pbignLicpfTogJHtpLm1lc3NhZ2V9YClcbiAgICAgIC5qb2luKCdcXG4nKTtcbiAgICBjb25zb2xlLmVycm9yKCdJbnZhbGlkIGVudmlyb25tZW50IHZhcmlhYmxlczpcXG4nICsgZXJyb3JzKTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgZW52aXJvbm1lbnQgdmFyaWFibGVzJyk7XG4gIH1cbn1cblxuY29uc3QgZGVmYXVsdHMgPSB7XG4gIE5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTDogJ2h0dHA6Ly9sb2NhbGhvc3Q6NTQzMjEnLFxuICBORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWTogJ2Fub25fa2V5JyxcbiAgU1VQQUJBU0VfVVJMOiAnaHR0cDovL2xvY2FsaG9zdDo1NDMyMScsXG4gIFNVUEFCQVNFX1NFUlZJQ0VfS0VZOiAnc2VydmljZV9rZXknLFxuICBTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZOiAnc2VydmljZV9yb2xlX2tleScsXG4gIFRXSUxJT19BQ0NPVU5UX1NJRDogJ0FDWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFgnLFxuICBUV0lMSU9fQVVUSF9UT0tFTjogJ2F1dGhfdG9rZW4nLFxuICBUV0lMSU9fVkVSSUZZX1NFUlZJQ0VfU0lEOiAnVkFYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWCcsXG4gIFRXSUxJT19XSEFUU0FQUF9GUk9NOiAnd2hhdHNhcHA6KzEwMDAwMDAwMDAwJyxcbiAgUEFZTUVOVFNfUFJPVklERVI6ICdub25lJyxcbiAgTkVYVF9QVUJMSUNfUEFZTUVOVFNfUFJPVklERVI6ICdub25lJyxcbn07XG5cbmV4cG9ydCBjb25zdCBlbnYgPSAocGFyc2VkLnN1Y2Nlc3NcbiAgPyBwYXJzZWQuZGF0YVxuICA6IHtcbiAgICAgIC4uLmRlZmF1bHRzLFxuICAgICAgLi4ucmF3LFxuICAgICAgTkVYVF9QVUJMSUNfSURMRV9USU1FT1VUX01JTlVURVM6IE51bWJlcihcbiAgICAgICAgcmF3Lk5FWFRfUFVCTElDX0lETEVfVElNRU9VVF9NSU5VVEVTID8/IDMwLFxuICAgICAgKSxcbiAgICB9KTtcblxuZXhwb3J0IGNvbnN0IGlzQnJvd3NlciA9IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnO1xuZXhwb3J0IGNvbnN0IGlzU2VydmVyID0gIWlzQnJvd3NlcjtcbmV4cG9ydCBmdW5jdGlvbiBib29sKHZhbD86IHN0cmluZywgZmFsbGJhY2sgPSBmYWxzZSkge1xuICBpZiAodmFsID09IG51bGwpIHJldHVybiBmYWxsYmFjaztcbiAgcmV0dXJuIFsnMScsICd0cnVlJywgJ3llcycsICdvbiddLmluY2x1ZGVzKFN0cmluZyh2YWwpLnRvTG93ZXJDYXNlKCkpO1xufVxuIl0sIm5hbWVzIjpbInoiLCJlbnZTY2hlbWEiLCJvYmplY3QiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJzdHJpbmciLCJ1cmwiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSIsIm1pbiIsIk5FWFRfUFVCTElDX0JBU0VfVVJMIiwib3B0aW9uYWwiLCJORVhUX1BVQkxJQ19JRExFX1RJTUVPVVRfTUlOVVRFUyIsImNvZXJjZSIsIm51bWJlciIsImRlZmF1bHQiLCJORVhUX1BVQkxJQ19ERUJVRyIsIk5FWFRfUFVCTElDX1NJVEVfVVJMIiwiTkVYVF9QVUJMSUNfRkVBVFVSRV9UUklBTCIsIk5FWFRfUFVCTElDX0ZFQVRVUkVfUEFZV0FMTCIsIk5FWFRfUFVCTElDX0ZFQVRVUkVfUkVGRVJSQUwiLCJORVhUX1BVQkxJQ19GRUFUVVJFX1BBUlRORVIiLCJORVhUX1BVQkxJQ19GRUFUVVJFX1BSRURJQ1RPUiIsIk5FWFRfUFVCTElDX0ZFQVRVUkVfQ0hBTExFTkdFIiwiTkVYVF9QVUJMSUNfR0E0X0lEIiwiTkVYVF9QVUJMSUNfTUVUQV9QSVhFTF9JRCIsIk5FWFRfUFVCTElDX1NFTlRSWV9EU04iLCJORVhUX1BVQkxJQ19UV0lMSU9fQllQQVNTIiwiTkVYVF9QVUJMSUNfUEFZTUVOVFNfUFJPVklERVIiLCJlbnVtIiwiU1VQQUJBU0VfVVJMIiwiU1VQQUJBU0VfU0VSVklDRV9LRVkiLCJTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIiwiQURNSU5fRU1BSUxTIiwiR09PR0xFX0dFTkVSQVRJVkVfQUlfQVBJX0tFWSIsIkdST1FfQVBJX0tFWSIsIkdST1FfTU9ERUwiLCJPUEVOQUlfQVBJX0tFWSIsIk9QRU5BSV9NT0RFTCIsIkdFTUlOSV9BUElfS0VZIiwiR0VNSU5JX01PREVMIiwiR1hfQUlfUFJPVklERVIiLCJQUkVNSVVNX01BU1RFUl9QSU4iLCJQUkVNSVVNX1BJTl9IQVNIIiwiUFJFTUlVTV9QSU5fU0FMVCIsIlBSRU1JVU1fUElOX1JBVEUiLCJQUkVNSVVNX1BJTl9XSU5ET1dfU0VDIiwiU1RSSVBFX1NFQ1JFVF9LRVkiLCJTVFJJUEVfV0VCSE9PS19TRUNSRVQiLCJTVFJJUEVfUFJJQ0VfU1RBUlRFUl9NT05USExZIiwiU1RSSVBFX1BSSUNFX1NUQVJURVJfQU5OVUFMIiwiU1RSSVBFX1BSSUNFX0JPT1NURVJfTU9OVEhMWSIsIlNUUklQRV9QUklDRV9CT09TVEVSX0FOTlVBTCIsIlNUUklQRV9QUklDRV9NQVNURVJfTU9OVEhMWSIsIlNUUklQRV9QUklDRV9NQVNURVJfQU5OVUFMIiwiU1BFQUtJTkdfREFJTFlfTElNSVQiLCJTUEVBS0lOR19CVUNLRVQiLCJUV0lMSU9fQUNDT1VOVF9TSUQiLCJUV0lMSU9fQVVUSF9UT0tFTiIsIlRXSUxJT19WRVJJRllfU0VSVklDRV9TSUQiLCJUV0lMSU9fV0hBVFNBUFBfRlJPTSIsIlRXSUxJT19CWVBBU1MiLCJORVhUX1BVQkxJQ19ERVZfUEFZTUVOVFMiLCJFQVNZUEFTQV9NRVJDSEFOVF9JRCIsIkVBU1lQQVNBX1NFQ1JFVCIsIkpBWlpDQVNIX01FUkNIQU5UX0lEIiwiSkFaWkNBU0hfSU5URUdSSVRZX1NBTFQiLCJMT0NBTF9BRE1JTl9UT0tFTiIsIkFETUlOX0FQSV9UT0tFTiIsIlNJVEVfVVJMIiwiUEFZTUVOVFNfUFJPVklERVIiLCJQT1JUIiwiTk9ERV9FTlYiLCJyYXciLCJwcm9jZXNzIiwiZW52Iiwic2tpcFZhbGlkYXRpb24iLCJTS0lQX0VOVl9WQUxJREFUSU9OIiwiaXNQcm9kQnVpbGQiLCJWRVJDRUxfRU5WIiwicGFyc2VkIiwic2FmZVBhcnNlIiwic3VjY2VzcyIsIndhcm5pbmdzIiwiZXJyb3IiLCJpc3N1ZXMiLCJtYXAiLCJpIiwicGF0aCIsImpvaW4iLCJtZXNzYWdlIiwiY29uc29sZSIsIndhcm4iLCJlcnJvcnMiLCJFcnJvciIsImRlZmF1bHRzIiwiZGF0YSIsIk51bWJlciIsImlzQnJvd3NlciIsImlzU2VydmVyIiwiYm9vbCIsInZhbCIsImZhbGxiYWNrIiwiaW5jbHVkZXMiLCJTdHJpbmciLCJ0b0xvd2VyQ2FzZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./lib/env.ts\n");

/***/ }),

/***/ "(api)/./lib/supabaseServer.ts":
/*!*******************************!*\
  !*** ./lib/supabaseServer.ts ***!
  \*******************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createSupabaseServerClient: () => (/* binding */ createSupabaseServerClient),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   getServerUser: () => (/* binding */ getServerUser),\n/* harmony export */   supabaseServer: () => (/* binding */ supabaseServer),\n/* harmony export */   supabaseService: () => (/* binding */ supabaseService)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"@supabase/supabase-js\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _lib_env__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/env */ \"(api)/./lib/env.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_env__WEBPACK_IMPORTED_MODULE_1__]);\n_lib_env__WEBPACK_IMPORTED_MODULE_1__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n// lib/supabaseServer.ts\n// Server-side Supabase helpers for Pages Router.\n// Exported helpers:\n// - createSupabaseServerClient(opts)\n// - supabaseServer(req?, cookie?)\n// - supabaseService()\n// - getServerUser(req?)\n\n\n/** Small, reliable Promise-returning helper for stubbed results */ const resolved = (payload)=>Promise.resolve(payload);\n/** Test-friendly stub that mirrors the minimal supabase client surface used in handlers/tests */ function makeTestStub() {\n    const fromHandler = (_table)=>({\n            async insert (rows) {\n                // mimic supabase insert response shape\n                return resolved({\n                    data: Array.isArray(rows) ? rows.map((r, i)=>({\n                            id: `stub-${i + 1}`,\n                            ...r\n                        })) : [\n                        {\n                            id: \"stub-1\",\n                            ...rows\n                        }\n                    ],\n                    error: null\n                });\n            },\n            async select (_cols) {\n                return resolved({\n                    data: [],\n                    error: null\n                });\n            },\n            async update (_rows) {\n                return resolved({\n                    data: null,\n                    error: null\n                });\n            },\n            async delete () {\n                return resolved({\n                    data: null,\n                    error: null\n                });\n            }\n        });\n    return {\n        auth: {\n            async getUser () {\n                return resolved({\n                    data: {\n                        user: null\n                    },\n                    error: null\n                });\n            },\n            async getSession () {\n                return resolved({\n                    data: {\n                        session: null\n                    },\n                    error: null\n                });\n            }\n        },\n        from: fromHandler\n    };\n}\nconst URL = _lib_env__WEBPACK_IMPORTED_MODULE_1__.env.NEXT_PUBLIC_SUPABASE_URL || _lib_env__WEBPACK_IMPORTED_MODULE_1__.env.SUPABASE_URL;\nconst ANON_KEY = _lib_env__WEBPACK_IMPORTED_MODULE_1__.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\nconst SERVICE_KEY = _lib_env__WEBPACK_IMPORTED_MODULE_1__.env.SUPABASE_SERVICE_KEY ?? _lib_env__WEBPACK_IMPORTED_MODULE_1__.env.SUPABASE_SERVICE_ROLE_KEY;\n/**\n * Generic factory to create supabase server client. Use opts.serviceRole=true for a service-role client.\n */ function createSupabaseServerClient(opts = {}) {\n    const isTest =  false || process.env.SKIP_ENV_VALIDATION === \"true\";\n    if (!URL || !(ANON_KEY || SERVICE_KEY)) {\n        if (isTest) return makeTestStub();\n        throw new Error(\"Missing Supabase env vars (NEXT_PUBLIC_SUPABASE_URL / anon/service keys).\");\n    }\n    const key = opts.serviceRole ? SERVICE_KEY : ANON_KEY;\n    if (!key && !isTest) throw new Error(\"Supabase key is missing for requested client.\");\n    const headers = {\n        \"X-Client-Info\": \"gramorx/pages-router\",\n        ...opts.headers || {}\n    };\n    const authHeader = opts.req?.headers?.authorization;\n    if (authHeader && !headers[\"Authorization\"]) headers[\"Authorization\"] = String(authHeader);\n    const cookieHeader = opts.req?.headers?.cookie;\n    if (cookieHeader && !headers[\"Cookie\"]) headers[\"Cookie\"] = String(cookieHeader);\n    return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(URL, String(key), {\n        auth: {\n            persistSession: false,\n            autoRefreshToken: false\n        },\n        global: {\n            headers,\n            fetch: (...args)=>fetch(...args)\n        }\n    });\n}\n/**\n * Convenience anon client for server routes (for reading auth / user info).\n */ function supabaseServer(req, cookieHeader) {\n    const isTest =  false || process.env.SKIP_ENV_VALIDATION === \"true\";\n    if (!URL || !ANON_KEY) {\n        if (isTest) return makeTestStub();\n        throw new Error(\"Missing NEXT_PUBLIC_SUPABASE_URL or NEXT_PUBLIC_SUPABASE_ANON_KEY\");\n    }\n    const headers = {\n        \"X-Client-Info\": \"gramorx/pages-router\"\n    };\n    const cookie = cookieHeader ?? req?.headers?.cookie;\n    if (cookie) headers[\"Cookie\"] = String(cookie);\n    return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(URL, ANON_KEY, {\n        auth: {\n            persistSession: false,\n            autoRefreshToken: false\n        },\n        global: {\n            headers,\n            fetch: (...args)=>fetch(...args)\n        }\n    });\n}\nfunction supabaseService() {\n    if (false) {}\n    const isTest =  false || process.env.SKIP_ENV_VALIDATION === \"true\";\n    if (!URL || !SERVICE_KEY) {\n        if (isTest) return makeTestStub();\n        throw new Error(\"Missing SUPABASE_SERVICE_KEY (or SUPABASE_SERVICE_ROLE_KEY).\");\n    }\n    // reuse existing client if present\n    // @ts-expect-error - supabase types mismatch under server ctx\n    if (globalThis.__supabaseServiceClient) {\n        // @ts-expect-error - supabase types mismatch under server ctx\n        return globalThis.__supabaseServiceClient;\n    }\n    // create and cache\n    // @ts-expect-error - supabase types mismatch under server ctx\n    globalThis.__supabaseServiceClient = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(URL, SERVICE_KEY, {\n        auth: {\n            persistSession: false,\n            autoRefreshToken: false\n        },\n        global: {\n            headers: {\n                \"X-Client-Info\": \"gramorx/pages-router-service\"\n            },\n            fetch: (...args)=>fetch(...args)\n        }\n    });\n    // @ts-expect-error - supabase types mismatch under server ctx\n    return globalThis.__supabaseServiceClient;\n}\n/**\n * Convenience helper to return the server user (or null).\n */ async function getServerUser(req) {\n    const sb = supabaseServer(req);\n    try {\n        const { data } = await sb.auth.getUser();\n        return data && (data.user ?? null) || null;\n    } catch  {\n        return null;\n    }\n}\n// Default export for CJS compatibility\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (createSupabaseServerClient);\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9saWIvc3VwYWJhc2VTZXJ2ZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBQSx3QkFBd0I7QUFDeEIsaURBQWlEO0FBQ2pELG9CQUFvQjtBQUNwQixxQ0FBcUM7QUFDckMsa0NBQWtDO0FBQ2xDLHNCQUFzQjtBQUN0Qix3QkFBd0I7QUFFa0Q7QUFFMUM7QUFXaEMsaUVBQWlFLEdBQ2pFLE1BQU1FLFdBQVcsQ0FBQ0MsVUFBaUJDLFFBQVFDLE9BQU8sQ0FBQ0Y7QUFFbkQsK0ZBQStGLEdBQy9GLFNBQVNHO0lBQ1AsTUFBTUMsY0FBYyxDQUFDQyxTQUFvQjtZQUN2QyxNQUFNQyxRQUFPQyxJQUFTO2dCQUNwQix1Q0FBdUM7Z0JBQ3ZDLE9BQU9SLFNBQVM7b0JBQUVTLE1BQU1DLE1BQU1DLE9BQU8sQ0FBQ0gsUUFBUUEsS0FBS0ksR0FBRyxDQUFDLENBQUNDLEdBQUdDLElBQU87NEJBQUVDLElBQUksQ0FBQyxLQUFLLEVBQUVELElBQUksRUFBRSxDQUFDOzRCQUFFLEdBQUdELENBQUM7d0JBQUMsTUFBTTt3QkFBQzs0QkFBRUUsSUFBSTs0QkFBVSxHQUFHUCxJQUFJO3dCQUFDO3FCQUFFO29CQUFFUSxPQUFPO2dCQUFLO1lBQy9JO1lBQ0EsTUFBTUMsUUFBT0MsS0FBYztnQkFDekIsT0FBT2xCLFNBQVM7b0JBQUVTLE1BQU0sRUFBRTtvQkFBRU8sT0FBTztnQkFBSztZQUMxQztZQUNBLE1BQU1HLFFBQU9DLEtBQVU7Z0JBQ3JCLE9BQU9wQixTQUFTO29CQUFFUyxNQUFNO29CQUFNTyxPQUFPO2dCQUFLO1lBQzVDO1lBQ0EsTUFBTUs7Z0JBQ0osT0FBT3JCLFNBQVM7b0JBQUVTLE1BQU07b0JBQU1PLE9BQU87Z0JBQUs7WUFDNUM7UUFDRjtJQUVBLE9BQU87UUFDTE0sTUFBTTtZQUNKLE1BQU1DO2dCQUNKLE9BQU92QixTQUFTO29CQUFFUyxNQUFNO3dCQUFFZSxNQUFNO29CQUFLO29CQUFHUixPQUFPO2dCQUFLO1lBQ3REO1lBQ0EsTUFBTVM7Z0JBQ0osT0FBT3pCLFNBQVM7b0JBQUVTLE1BQU07d0JBQUVpQixTQUFTO29CQUFLO29CQUFHVixPQUFPO2dCQUFLO1lBQ3pEO1FBQ0Y7UUFDQVcsTUFBTXRCO0lBQ1I7QUFDRjtBQUVBLE1BQU11QixNQUFNN0IseUNBQUdBLENBQUM4Qix3QkFBd0IsSUFBSTlCLHlDQUFHQSxDQUFDK0IsWUFBWTtBQUM1RCxNQUFNQyxXQUFXaEMseUNBQUdBLENBQUNpQyw2QkFBNkI7QUFDbEQsTUFBTUMsY0FBYywwQ0FBYUMsb0JBQW9CLElBQUluQyx5Q0FBR0EsQ0FBQ29DLHlCQUF5QjtBQUV0Rjs7Q0FFQyxHQUNNLFNBQVNDLDJCQUFtQ0MsT0FBbUIsQ0FBQyxDQUFDO0lBQ3RFLE1BQU1DLFNBQVNDLE1BQXlCLElBQVVBLFFBQVF4QyxHQUFHLENBQUN5QyxtQkFBbUIsS0FBSztJQUN0RixJQUFJLENBQUNaLE9BQVEsQ0FBRUcsQ0FBQUEsWUFBWUUsV0FBVSxHQUFLO1FBQ3hDLElBQUlLLFFBQVEsT0FBT2xDO1FBQ25CLE1BQU0sSUFBSXFDLE1BQU07SUFDbEI7SUFFQSxNQUFNQyxNQUFNTCxLQUFLTSxXQUFXLEdBQUdWLGNBQWNGO0lBQzdDLElBQUksQ0FBQ1csT0FBTyxDQUFDSixRQUFRLE1BQU0sSUFBSUcsTUFBTTtJQUVyQyxNQUFNRyxVQUFrQztRQUN0QyxpQkFBaUI7UUFDakIsR0FBSVAsS0FBS08sT0FBTyxJQUFJLENBQUMsQ0FBQztJQUN4QjtJQUVBLE1BQU1DLGFBQWFSLEtBQUtTLEdBQUcsRUFBRUYsU0FBU0c7SUFDdEMsSUFBSUYsY0FBYyxDQUFDRCxPQUFPLENBQUMsZ0JBQWdCLEVBQUVBLE9BQU8sQ0FBQyxnQkFBZ0IsR0FBR0ksT0FBT0g7SUFDL0UsTUFBTUksZUFBZVosS0FBS1MsR0FBRyxFQUFFRixTQUFTTTtJQUN4QyxJQUFJRCxnQkFBZ0IsQ0FBQ0wsT0FBTyxDQUFDLFNBQVMsRUFBRUEsT0FBTyxDQUFDLFNBQVMsR0FBR0ksT0FBT0M7SUFFbkUsT0FBT25ELG1FQUFZQSxDQUFJOEIsS0FBS29CLE9BQU9OLE1BQU07UUFDdkNwQixNQUFNO1lBQUU2QixnQkFBZ0I7WUFBT0Msa0JBQWtCO1FBQU07UUFDdkRDLFFBQVE7WUFDTlQ7WUFDQVUsT0FBTyxDQUFDLEdBQUdDLE9BQVNELFNBQVNDO1FBQy9CO0lBQ0Y7QUFDRjtBQUVBOztDQUVDLEdBQ00sU0FBU0MsZUFBZVYsR0FBb0IsRUFBRUcsWUFBcUI7SUFDeEUsTUFBTVgsU0FBU0MsTUFBeUIsSUFBVUEsUUFBUXhDLEdBQUcsQ0FBQ3lDLG1CQUFtQixLQUFLO0lBQ3RGLElBQUksQ0FBQ1osT0FBTyxDQUFDRyxVQUFVO1FBQ3JCLElBQUlPLFFBQVEsT0FBT2xDO1FBQ25CLE1BQU0sSUFBSXFDLE1BQU07SUFDbEI7SUFFQSxNQUFNRyxVQUFrQztRQUFFLGlCQUFpQjtJQUF1QjtJQUNsRixNQUFNTSxTQUFTRCxnQkFBZ0JILEtBQUtGLFNBQVNNO0lBQzdDLElBQUlBLFFBQVFOLE9BQU8sQ0FBQyxTQUFTLEdBQUdJLE9BQU9FO0lBRXZDLE9BQU9wRCxtRUFBWUEsQ0FBSzhCLEtBQUtHLFVBQVU7UUFDckNULE1BQU07WUFBRTZCLGdCQUFnQjtZQUFPQyxrQkFBa0I7UUFBTTtRQUN2REMsUUFBUTtZQUNOVDtZQUNBVSxPQUFPLENBQUMsR0FBR0MsT0FBU0QsU0FBU0M7UUFDL0I7SUFDRjtBQUNGO0FBU08sU0FBU0U7SUFDZCxJQUFJLEtBQWtCLEVBQWEsRUFBZ0I7SUFFbkQsTUFBTW5CLFNBQVNDLE1BQXlCLElBQVVBLFFBQVF4QyxHQUFHLENBQUN5QyxtQkFBbUIsS0FBSztJQUN0RixJQUFJLENBQUNaLE9BQU8sQ0FBQ0ssYUFBYTtRQUN4QixJQUFJSyxRQUFRLE9BQU9sQztRQUNuQixNQUFNLElBQUlxQyxNQUFNO0lBQ2xCO0lBRUEsbUNBQW1DO0lBQ25DLDhEQUE4RDtJQUM5RCxJQUFJaUIsV0FBV0MsdUJBQXVCLEVBQUU7UUFDdEMsOERBQThEO1FBQzlELE9BQU9ELFdBQVdDLHVCQUF1QjtJQUMzQztJQUVBLG1CQUFtQjtJQUNuQiw4REFBOEQ7SUFDOURELFdBQVdDLHVCQUF1QixHQUFHN0QsbUVBQVlBLENBQUs4QixLQUFLSyxhQUFhO1FBQ3RFWCxNQUFNO1lBQUU2QixnQkFBZ0I7WUFBT0Msa0JBQWtCO1FBQU07UUFDdkRDLFFBQVE7WUFDTlQsU0FBUztnQkFBRSxpQkFBaUI7WUFBK0I7WUFDM0RVLE9BQU8sQ0FBQyxHQUFHQyxPQUFTRCxTQUFTQztRQUMvQjtJQUNGO0lBRUEsOERBQThEO0lBQzlELE9BQU9HLFdBQVdDLHVCQUF1QjtBQUMzQztBQUVBOztDQUVDLEdBQ00sZUFBZUMsY0FBY2QsR0FBb0I7SUFDdEQsTUFBTWUsS0FBS0wsZUFBZVY7SUFDMUIsSUFBSTtRQUNGLE1BQU0sRUFBRXJDLElBQUksRUFBRSxHQUFHLE1BQU1vRCxHQUFHdkMsSUFBSSxDQUFDQyxPQUFPO1FBQ3RDLE9BQU8sUUFBVWQsQ0FBQUEsS0FBS2UsSUFBSSxJQUFJLElBQUcsS0FBTztJQUMxQyxFQUFFLE9BQU07UUFDTixPQUFPO0lBQ1Q7QUFDRjtBQUVBLHVDQUF1QztBQUN2QyxpRUFBZVksMEJBQTBCQSxFQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZ3JhbW9yX3gvLi9saWIvc3VwYWJhc2VTZXJ2ZXIudHM/Yzc4YyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBsaWIvc3VwYWJhc2VTZXJ2ZXIudHNcbi8vIFNlcnZlci1zaWRlIFN1cGFiYXNlIGhlbHBlcnMgZm9yIFBhZ2VzIFJvdXRlci5cbi8vIEV4cG9ydGVkIGhlbHBlcnM6XG4vLyAtIGNyZWF0ZVN1cGFiYXNlU2VydmVyQ2xpZW50KG9wdHMpXG4vLyAtIHN1cGFiYXNlU2VydmVyKHJlcT8sIGNvb2tpZT8pXG4vLyAtIHN1cGFiYXNlU2VydmljZSgpXG4vLyAtIGdldFNlcnZlclVzZXIocmVxPylcblxuaW1wb3J0IHsgY3JlYXRlQ2xpZW50LCB0eXBlIFN1cGFiYXNlQ2xpZW50IH0gZnJvbSAnQHN1cGFiYXNlL3N1cGFiYXNlLWpzJztcbmltcG9ydCB0eXBlIHsgTmV4dEFwaVJlcXVlc3QgfSBmcm9tICduZXh0JztcbmltcG9ydCB7IGVudiB9IGZyb20gJ0AvbGliL2Vudic7XG5cbi8vIFJlcGxhY2UgYGFueWAgd2l0aCB5b3VyIGdlbmVyYXRlZCBEYXRhYmFzZSB0eXBlIHdoZW4gYXZhaWxhYmxlXG50eXBlIERCID0gYW55O1xuXG50eXBlIENyZWF0ZU9wdHMgPSB7XG4gIHJlcT86IE5leHRBcGlSZXF1ZXN0O1xuICBzZXJ2aWNlUm9sZT86IGJvb2xlYW47XG4gIGhlYWRlcnM/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+O1xufTtcblxuLyoqIFNtYWxsLCByZWxpYWJsZSBQcm9taXNlLXJldHVybmluZyBoZWxwZXIgZm9yIHN0dWJiZWQgcmVzdWx0cyAqL1xuY29uc3QgcmVzb2x2ZWQgPSAocGF5bG9hZDogYW55KSA9PiBQcm9taXNlLnJlc29sdmUocGF5bG9hZCk7XG5cbi8qKiBUZXN0LWZyaWVuZGx5IHN0dWIgdGhhdCBtaXJyb3JzIHRoZSBtaW5pbWFsIHN1cGFiYXNlIGNsaWVudCBzdXJmYWNlIHVzZWQgaW4gaGFuZGxlcnMvdGVzdHMgKi9cbmZ1bmN0aW9uIG1ha2VUZXN0U3R1YigpOiBTdXBhYmFzZUNsaWVudDxEQj4ge1xuICBjb25zdCBmcm9tSGFuZGxlciA9IChfdGFibGU6IHN0cmluZykgPT4gKHtcbiAgICBhc3luYyBpbnNlcnQocm93czogYW55KSB7XG4gICAgICAvLyBtaW1pYyBzdXBhYmFzZSBpbnNlcnQgcmVzcG9uc2Ugc2hhcGVcbiAgICAgIHJldHVybiByZXNvbHZlZCh7IGRhdGE6IEFycmF5LmlzQXJyYXkocm93cykgPyByb3dzLm1hcCgociwgaSkgPT4gKHsgaWQ6IGBzdHViLSR7aSArIDF9YCwgLi4uciB9KSkgOiBbeyBpZDogJ3N0dWItMScsIC4uLnJvd3MgfV0sIGVycm9yOiBudWxsIH0pO1xuICAgIH0sXG4gICAgYXN5bmMgc2VsZWN0KF9jb2xzPzogc3RyaW5nKSB7XG4gICAgICByZXR1cm4gcmVzb2x2ZWQoeyBkYXRhOiBbXSwgZXJyb3I6IG51bGwgfSk7XG4gICAgfSxcbiAgICBhc3luYyB1cGRhdGUoX3Jvd3M6IGFueSkge1xuICAgICAgcmV0dXJuIHJlc29sdmVkKHsgZGF0YTogbnVsbCwgZXJyb3I6IG51bGwgfSk7XG4gICAgfSxcbiAgICBhc3luYyBkZWxldGUoKSB7XG4gICAgICByZXR1cm4gcmVzb2x2ZWQoeyBkYXRhOiBudWxsLCBlcnJvcjogbnVsbCB9KTtcbiAgICB9LFxuICB9KTtcblxuICByZXR1cm4ge1xuICAgIGF1dGg6IHtcbiAgICAgIGFzeW5jIGdldFVzZXIoKSB7XG4gICAgICAgIHJldHVybiByZXNvbHZlZCh7IGRhdGE6IHsgdXNlcjogbnVsbCB9LCBlcnJvcjogbnVsbCB9KTtcbiAgICAgIH0sXG4gICAgICBhc3luYyBnZXRTZXNzaW9uKCkge1xuICAgICAgICByZXR1cm4gcmVzb2x2ZWQoeyBkYXRhOiB7IHNlc3Npb246IG51bGwgfSwgZXJyb3I6IG51bGwgfSk7XG4gICAgICB9LFxuICAgIH0sXG4gICAgZnJvbTogZnJvbUhhbmRsZXIsXG4gIH0gYXMgdW5rbm93biBhcyBTdXBhYmFzZUNsaWVudDxEQj47XG59XG5cbmNvbnN0IFVSTCA9IGVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwgfHwgZW52LlNVUEFCQVNFX1VSTDtcbmNvbnN0IEFOT05fS0VZID0gZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZO1xuY29uc3QgU0VSVklDRV9LRVkgPSAoZW52IGFzIGFueSkuU1VQQUJBU0VfU0VSVklDRV9LRVkgPz8gZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVk7XG5cbi8qKlxuICogR2VuZXJpYyBmYWN0b3J5IHRvIGNyZWF0ZSBzdXBhYmFzZSBzZXJ2ZXIgY2xpZW50LiBVc2Ugb3B0cy5zZXJ2aWNlUm9sZT10cnVlIGZvciBhIHNlcnZpY2Utcm9sZSBjbGllbnQuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVTdXBhYmFzZVNlcnZlckNsaWVudDxUID0gREI+KG9wdHM6IENyZWF0ZU9wdHMgPSB7fSk6IFN1cGFiYXNlQ2xpZW50PFQ+IHtcbiAgY29uc3QgaXNUZXN0ID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICd0ZXN0JyB8fCBwcm9jZXNzLmVudi5TS0lQX0VOVl9WQUxJREFUSU9OID09PSAndHJ1ZSc7XG4gIGlmICghVVJMIHx8ICghKEFOT05fS0VZIHx8IFNFUlZJQ0VfS0VZKSkpIHtcbiAgICBpZiAoaXNUZXN0KSByZXR1cm4gbWFrZVRlc3RTdHViKCkgYXMgdW5rbm93biBhcyBTdXBhYmFzZUNsaWVudDxUPjtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ01pc3NpbmcgU3VwYWJhc2UgZW52IHZhcnMgKE5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCAvIGFub24vc2VydmljZSBrZXlzKS4nKTtcbiAgfVxuXG4gIGNvbnN0IGtleSA9IG9wdHMuc2VydmljZVJvbGUgPyBTRVJWSUNFX0tFWSA6IEFOT05fS0VZO1xuICBpZiAoIWtleSAmJiAhaXNUZXN0KSB0aHJvdyBuZXcgRXJyb3IoJ1N1cGFiYXNlIGtleSBpcyBtaXNzaW5nIGZvciByZXF1ZXN0ZWQgY2xpZW50LicpO1xuXG4gIGNvbnN0IGhlYWRlcnM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7XG4gICAgJ1gtQ2xpZW50LUluZm8nOiAnZ3JhbW9yeC9wYWdlcy1yb3V0ZXInLFxuICAgIC4uLihvcHRzLmhlYWRlcnMgfHwge30pLFxuICB9O1xuXG4gIGNvbnN0IGF1dGhIZWFkZXIgPSBvcHRzLnJlcT8uaGVhZGVycz8uYXV0aG9yaXphdGlvbjtcbiAgaWYgKGF1dGhIZWFkZXIgJiYgIWhlYWRlcnNbJ0F1dGhvcml6YXRpb24nXSkgaGVhZGVyc1snQXV0aG9yaXphdGlvbiddID0gU3RyaW5nKGF1dGhIZWFkZXIpO1xuICBjb25zdCBjb29raWVIZWFkZXIgPSBvcHRzLnJlcT8uaGVhZGVycz8uY29va2llO1xuICBpZiAoY29va2llSGVhZGVyICYmICFoZWFkZXJzWydDb29raWUnXSkgaGVhZGVyc1snQ29va2llJ10gPSBTdHJpbmcoY29va2llSGVhZGVyKTtcblxuICByZXR1cm4gY3JlYXRlQ2xpZW50PFQ+KFVSTCwgU3RyaW5nKGtleSksIHtcbiAgICBhdXRoOiB7IHBlcnNpc3RTZXNzaW9uOiBmYWxzZSwgYXV0b1JlZnJlc2hUb2tlbjogZmFsc2UgfSxcbiAgICBnbG9iYWw6IHtcbiAgICAgIGhlYWRlcnMsXG4gICAgICBmZXRjaDogKC4uLmFyZ3MpID0+IGZldGNoKC4uLmFyZ3MpLFxuICAgIH0sXG4gIH0pO1xufVxuXG4vKipcbiAqIENvbnZlbmllbmNlIGFub24gY2xpZW50IGZvciBzZXJ2ZXIgcm91dGVzIChmb3IgcmVhZGluZyBhdXRoIC8gdXNlciBpbmZvKS5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHN1cGFiYXNlU2VydmVyKHJlcT86IE5leHRBcGlSZXF1ZXN0LCBjb29raWVIZWFkZXI/OiBzdHJpbmcpOiBTdXBhYmFzZUNsaWVudDxEQj4ge1xuICBjb25zdCBpc1Rlc3QgPSBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Rlc3QnIHx8IHByb2Nlc3MuZW52LlNLSVBfRU5WX1ZBTElEQVRJT04gPT09ICd0cnVlJztcbiAgaWYgKCFVUkwgfHwgIUFOT05fS0VZKSB7XG4gICAgaWYgKGlzVGVzdCkgcmV0dXJuIG1ha2VUZXN0U3R1YigpO1xuICAgIHRocm93IG5ldyBFcnJvcignTWlzc2luZyBORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwgb3IgTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVknKTtcbiAgfVxuXG4gIGNvbnN0IGhlYWRlcnM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7ICdYLUNsaWVudC1JbmZvJzogJ2dyYW1vcngvcGFnZXMtcm91dGVyJyB9O1xuICBjb25zdCBjb29raWUgPSBjb29raWVIZWFkZXIgPz8gcmVxPy5oZWFkZXJzPy5jb29raWU7XG4gIGlmIChjb29raWUpIGhlYWRlcnNbJ0Nvb2tpZSddID0gU3RyaW5nKGNvb2tpZSk7XG5cbiAgcmV0dXJuIGNyZWF0ZUNsaWVudDxEQj4oVVJMLCBBTk9OX0tFWSwge1xuICAgIGF1dGg6IHsgcGVyc2lzdFNlc3Npb246IGZhbHNlLCBhdXRvUmVmcmVzaFRva2VuOiBmYWxzZSB9LFxuICAgIGdsb2JhbDoge1xuICAgICAgaGVhZGVycyxcbiAgICAgIGZldGNoOiAoLi4uYXJncykgPT4gZmV0Y2goLi4uYXJncyksXG4gICAgfSxcbiAgfSk7XG59XG5cbi8qKlxuICogU2VydmljZS1yb2xlIGNsaWVudCAoc2VydmVyLW9ubHkpLiBDYWNoZWQgb24gZ2xvYmFsVGhpcyB0byBhdm9pZCByZWNyZWF0aW9uIGFjcm9zcyBITVIuXG4gKi9cbmRlY2xhcmUgZ2xvYmFsIHtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXZhclxuICB2YXIgX19zdXBhYmFzZVNlcnZpY2VDbGllbnQ6IFJldHVyblR5cGU8dHlwZW9mIGNyZWF0ZUNsaWVudD4gfCB1bmRlZmluZWQ7XG59XG5leHBvcnQgZnVuY3Rpb24gc3VwYWJhc2VTZXJ2aWNlKCk6IFN1cGFiYXNlQ2xpZW50PERCPiB7XG4gIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykgdGhyb3cgbmV3IEVycm9yKCdzdXBhYmFzZVNlcnZpY2UoKSBjYW4gb25seSBiZSB1c2VkIG9uIHRoZSBzZXJ2ZXIuJyk7XG5cbiAgY29uc3QgaXNUZXN0ID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICd0ZXN0JyB8fCBwcm9jZXNzLmVudi5TS0lQX0VOVl9WQUxJREFUSU9OID09PSAndHJ1ZSc7XG4gIGlmICghVVJMIHx8ICFTRVJWSUNFX0tFWSkge1xuICAgIGlmIChpc1Rlc3QpIHJldHVybiBtYWtlVGVzdFN0dWIoKTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ01pc3NpbmcgU1VQQUJBU0VfU0VSVklDRV9LRVkgKG9yIFNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkpLicpO1xuICB9XG5cbiAgLy8gcmV1c2UgZXhpc3RpbmcgY2xpZW50IGlmIHByZXNlbnRcbiAgLy8gQHRzLWV4cGVjdC1lcnJvciAtIHN1cGFiYXNlIHR5cGVzIG1pc21hdGNoIHVuZGVyIHNlcnZlciBjdHhcbiAgaWYgKGdsb2JhbFRoaXMuX19zdXBhYmFzZVNlcnZpY2VDbGllbnQpIHtcbiAgICAvLyBAdHMtZXhwZWN0LWVycm9yIC0gc3VwYWJhc2UgdHlwZXMgbWlzbWF0Y2ggdW5kZXIgc2VydmVyIGN0eFxuICAgIHJldHVybiBnbG9iYWxUaGlzLl9fc3VwYWJhc2VTZXJ2aWNlQ2xpZW50O1xuICB9XG5cbiAgLy8gY3JlYXRlIGFuZCBjYWNoZVxuICAvLyBAdHMtZXhwZWN0LWVycm9yIC0gc3VwYWJhc2UgdHlwZXMgbWlzbWF0Y2ggdW5kZXIgc2VydmVyIGN0eFxuICBnbG9iYWxUaGlzLl9fc3VwYWJhc2VTZXJ2aWNlQ2xpZW50ID0gY3JlYXRlQ2xpZW50PERCPihVUkwsIFNFUlZJQ0VfS0VZLCB7XG4gICAgYXV0aDogeyBwZXJzaXN0U2Vzc2lvbjogZmFsc2UsIGF1dG9SZWZyZXNoVG9rZW46IGZhbHNlIH0sXG4gICAgZ2xvYmFsOiB7XG4gICAgICBoZWFkZXJzOiB7ICdYLUNsaWVudC1JbmZvJzogJ2dyYW1vcngvcGFnZXMtcm91dGVyLXNlcnZpY2UnIH0sXG4gICAgICBmZXRjaDogKC4uLmFyZ3MpID0+IGZldGNoKC4uLmFyZ3MpLFxuICAgIH0sXG4gIH0pO1xuXG4gIC8vIEB0cy1leHBlY3QtZXJyb3IgLSBzdXBhYmFzZSB0eXBlcyBtaXNtYXRjaCB1bmRlciBzZXJ2ZXIgY3R4XG4gIHJldHVybiBnbG9iYWxUaGlzLl9fc3VwYWJhc2VTZXJ2aWNlQ2xpZW50O1xufVxuXG4vKipcbiAqIENvbnZlbmllbmNlIGhlbHBlciB0byByZXR1cm4gdGhlIHNlcnZlciB1c2VyIChvciBudWxsKS5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFNlcnZlclVzZXIocmVxPzogTmV4dEFwaVJlcXVlc3QpIHtcbiAgY29uc3Qgc2IgPSBzdXBhYmFzZVNlcnZlcihyZXEpO1xuICB0cnkge1xuICAgIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgc2IuYXV0aC5nZXRVc2VyKCk7XG4gICAgcmV0dXJuIChkYXRhICYmIChkYXRhLnVzZXIgPz8gbnVsbCkpIHx8IG51bGw7XG4gIH0gY2F0Y2gge1xuICAgIHJldHVybiBudWxsO1xuICB9XG59XG5cbi8vIERlZmF1bHQgZXhwb3J0IGZvciBDSlMgY29tcGF0aWJpbGl0eVxuZXhwb3J0IGRlZmF1bHQgY3JlYXRlU3VwYWJhc2VTZXJ2ZXJDbGllbnQ7XG4iXSwibmFtZXMiOlsiY3JlYXRlQ2xpZW50IiwiZW52IiwicmVzb2x2ZWQiLCJwYXlsb2FkIiwiUHJvbWlzZSIsInJlc29sdmUiLCJtYWtlVGVzdFN0dWIiLCJmcm9tSGFuZGxlciIsIl90YWJsZSIsImluc2VydCIsInJvd3MiLCJkYXRhIiwiQXJyYXkiLCJpc0FycmF5IiwibWFwIiwiciIsImkiLCJpZCIsImVycm9yIiwic2VsZWN0IiwiX2NvbHMiLCJ1cGRhdGUiLCJfcm93cyIsImRlbGV0ZSIsImF1dGgiLCJnZXRVc2VyIiwidXNlciIsImdldFNlc3Npb24iLCJzZXNzaW9uIiwiZnJvbSIsIlVSTCIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsIlNVUEFCQVNFX1VSTCIsIkFOT05fS0VZIiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkiLCJTRVJWSUNFX0tFWSIsIlNVUEFCQVNFX1NFUlZJQ0VfS0VZIiwiU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSIsImNyZWF0ZVN1cGFiYXNlU2VydmVyQ2xpZW50Iiwib3B0cyIsImlzVGVzdCIsInByb2Nlc3MiLCJTS0lQX0VOVl9WQUxJREFUSU9OIiwiRXJyb3IiLCJrZXkiLCJzZXJ2aWNlUm9sZSIsImhlYWRlcnMiLCJhdXRoSGVhZGVyIiwicmVxIiwiYXV0aG9yaXphdGlvbiIsIlN0cmluZyIsImNvb2tpZUhlYWRlciIsImNvb2tpZSIsInBlcnNpc3RTZXNzaW9uIiwiYXV0b1JlZnJlc2hUb2tlbiIsImdsb2JhbCIsImZldGNoIiwiYXJncyIsInN1cGFiYXNlU2VydmVyIiwic3VwYWJhc2VTZXJ2aWNlIiwiZ2xvYmFsVGhpcyIsIl9fc3VwYWJhc2VTZXJ2aWNlQ2xpZW50IiwiZ2V0U2VydmVyVXNlciIsInNiIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./lib/supabaseServer.ts\n");

/***/ }),

/***/ "(api)/./pages/api/notifications/index.ts":
/*!******************************************!*\
  !*** ./pages/api/notifications/index.ts ***!
  \******************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _lib_supabaseServer__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/supabaseServer */ \"(api)/./lib/supabaseServer.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_lib_supabaseServer__WEBPACK_IMPORTED_MODULE_0__]);\n_lib_supabaseServer__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\nasync function handler(req, res) {\n    const supabase = (0,_lib_supabaseServer__WEBPACK_IMPORTED_MODULE_0__.createSupabaseServerClient)({\n        req\n    });\n    const { data: { user } } = await supabase.auth.getUser();\n    if (!user) return res.status(401).json({\n        error: \"Unauthorized\"\n    });\n    if (req.method === \"GET\") {\n        const { data, error } = await supabase.from(\"notifications\").select(\"id, title, body, url, read_at, created_at\").eq(\"user_id\", user.id).order(\"created_at\", {\n            ascending: false\n        });\n        if (error) return res.status(500).json({\n            error: error.message\n        });\n        const list = data ?? [];\n        if (list.length === 0) {\n            const welcome = {\n                id: \"welcome\",\n                title: \"Welcome to GramorX!\",\n                body: null,\n                url: null,\n                read_at: null,\n                created_at: new Date().toISOString()\n            };\n            return res.status(200).json({\n                notifications: [\n                    welcome\n                ],\n                unread: 1\n            });\n        }\n        return res.status(200).json({\n            notifications: list,\n            unread: list.filter((n)=>!n.read_at).length\n        });\n    }\n    if (req.method === \"POST\") {\n        const { title, body, url } = req.body;\n        if (!title && !body) return res.status(400).json({\n            error: \"Missing title or body\"\n        });\n        const { data, error } = await supabase.from(\"notifications\").insert({\n            user_id: user.id,\n            title,\n            body,\n            url\n        }).select(\"id, title, body, url, read_at, created_at\").single();\n        if (error) return res.status(500).json({\n            error: error.message\n        });\n        return res.status(201).json({\n            notification: data\n        });\n    }\n    res.setHeader(\"Allow\", \"GET,POST\");\n    return res.status(405).end(\"Method Not Allowed\");\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvbm90aWZpY2F0aW9ucy9pbmRleC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUNrRTtBQUVuRCxlQUFlQyxRQUFRQyxHQUFtQixFQUFFQyxHQUFvQjtJQUM3RSxNQUFNQyxXQUFXSiwrRUFBMEJBLENBQUM7UUFBRUU7SUFBSTtJQUNsRCxNQUFNLEVBQ0pHLE1BQU0sRUFBRUMsSUFBSSxFQUFFLEVBQ2YsR0FBRyxNQUFNRixTQUFTRyxJQUFJLENBQUNDLE9BQU87SUFDL0IsSUFBSSxDQUFDRixNQUFNLE9BQU9ILElBQUlNLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7UUFBRUMsT0FBTztJQUFlO0lBRS9ELElBQUlULElBQUlVLE1BQU0sS0FBSyxPQUFPO1FBQ3hCLE1BQU0sRUFBRVAsSUFBSSxFQUFFTSxLQUFLLEVBQUUsR0FBRyxNQUFNUCxTQUMzQlMsSUFBSSxDQUFDLGlCQUNMQyxNQUFNLENBQUMsNkNBQ1BDLEVBQUUsQ0FBQyxXQUFXVCxLQUFLVSxFQUFFLEVBQ3JCQyxLQUFLLENBQUMsY0FBYztZQUFFQyxXQUFXO1FBQU07UUFDMUMsSUFBSVAsT0FBTyxPQUFPUixJQUFJTSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQUVDLE9BQU9BLE1BQU1RLE9BQU87UUFBQztRQUM5RCxNQUFNQyxPQUFPZixRQUFRLEVBQUU7UUFDdkIsSUFBSWUsS0FBS0MsTUFBTSxLQUFLLEdBQUc7WUFDckIsTUFBTUMsVUFBVTtnQkFDZE4sSUFBSTtnQkFDSk8sT0FBTztnQkFDUEMsTUFBTTtnQkFDTkMsS0FBSztnQkFDTEMsU0FBUztnQkFDVEMsWUFBWSxJQUFJQyxPQUFPQyxXQUFXO1lBQ3BDO1lBQ0EsT0FBTzFCLElBQUlNLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7Z0JBQUVvQixlQUFlO29CQUFDUjtpQkFBUTtnQkFBRVMsUUFBUTtZQUFFO1FBQ3BFO1FBQ0EsT0FBTzVCLElBQUlNLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFBRW9CLGVBQWVWO1lBQU1XLFFBQVFYLEtBQUtZLE1BQU0sQ0FBQ0MsQ0FBQUEsSUFBSyxDQUFDQSxFQUFFUCxPQUFPLEVBQUVMLE1BQU07UUFBQztJQUNqRztJQUVBLElBQUluQixJQUFJVSxNQUFNLEtBQUssUUFBUTtRQUN6QixNQUFNLEVBQUVXLEtBQUssRUFBRUMsSUFBSSxFQUFFQyxHQUFHLEVBQUUsR0FBR3ZCLElBQUlzQixJQUFJO1FBQ3JDLElBQUksQ0FBQ0QsU0FBUyxDQUFDQyxNQUFNLE9BQU9yQixJQUFJTSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQUVDLE9BQU87UUFBd0I7UUFDbEYsTUFBTSxFQUFFTixJQUFJLEVBQUVNLEtBQUssRUFBRSxHQUFHLE1BQU1QLFNBQzNCUyxJQUFJLENBQUMsaUJBQ0xxQixNQUFNLENBQUM7WUFBRUMsU0FBUzdCLEtBQUtVLEVBQUU7WUFBRU87WUFBT0M7WUFBTUM7UUFBSSxHQUM1Q1gsTUFBTSxDQUFDLDZDQUNQc0IsTUFBTTtRQUNULElBQUl6QixPQUFPLE9BQU9SLElBQUlNLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFBRUMsT0FBT0EsTUFBTVEsT0FBTztRQUFDO1FBQzlELE9BQU9oQixJQUFJTSxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO1lBQUUyQixjQUFjaEM7UUFBSztJQUNuRDtJQUVBRixJQUFJbUMsU0FBUyxDQUFDLFNBQVM7SUFDdkIsT0FBT25DLElBQUlNLE1BQU0sQ0FBQyxLQUFLOEIsR0FBRyxDQUFDO0FBQzdCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZ3JhbW9yX3gvLi9wYWdlcy9hcGkvbm90aWZpY2F0aW9ucy9pbmRleC50cz9kZjNkIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgTmV4dEFwaVJlcXVlc3QsIE5leHRBcGlSZXNwb25zZSB9IGZyb20gJ25leHQnO1xuaW1wb3J0IHsgY3JlYXRlU3VwYWJhc2VTZXJ2ZXJDbGllbnQgfSBmcm9tICdAL2xpYi9zdXBhYmFzZVNlcnZlcic7XG5cbmV4cG9ydCBkZWZhdWx0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIocmVxOiBOZXh0QXBpUmVxdWVzdCwgcmVzOiBOZXh0QXBpUmVzcG9uc2UpIHtcbiAgY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVTdXBhYmFzZVNlcnZlckNsaWVudCh7IHJlcSB9KTtcbiAgY29uc3Qge1xuICAgIGRhdGE6IHsgdXNlciB9LFxuICB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG4gIGlmICghdXNlcikgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgZXJyb3I6ICdVbmF1dGhvcml6ZWQnIH0pO1xuXG4gIGlmIChyZXEubWV0aG9kID09PSAnR0VUJykge1xuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgnbm90aWZpY2F0aW9ucycpXG4gICAgICAuc2VsZWN0KCdpZCwgdGl0bGUsIGJvZHksIHVybCwgcmVhZF9hdCwgY3JlYXRlZF9hdCcpXG4gICAgICAuZXEoJ3VzZXJfaWQnLCB1c2VyLmlkKVxuICAgICAgLm9yZGVyKCdjcmVhdGVkX2F0JywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pO1xuICAgIGlmIChlcnJvcikgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfSk7XG4gICAgY29uc3QgbGlzdCA9IGRhdGEgPz8gW107XG4gICAgaWYgKGxpc3QubGVuZ3RoID09PSAwKSB7XG4gICAgICBjb25zdCB3ZWxjb21lID0ge1xuICAgICAgICBpZDogJ3dlbGNvbWUnLFxuICAgICAgICB0aXRsZTogJ1dlbGNvbWUgdG8gR3JhbW9yWCEnLFxuICAgICAgICBib2R5OiBudWxsLFxuICAgICAgICB1cmw6IG51bGwsXG4gICAgICAgIHJlYWRfYXQ6IG51bGwsXG4gICAgICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgIH07XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDApLmpzb24oeyBub3RpZmljYXRpb25zOiBbd2VsY29tZV0sIHVucmVhZDogMSB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgbm90aWZpY2F0aW9uczogbGlzdCwgdW5yZWFkOiBsaXN0LmZpbHRlcihuID0+ICFuLnJlYWRfYXQpLmxlbmd0aCB9KTtcbiAgfVxuXG4gIGlmIChyZXEubWV0aG9kID09PSAnUE9TVCcpIHtcbiAgICBjb25zdCB7IHRpdGxlLCBib2R5LCB1cmwgfSA9IHJlcS5ib2R5IGFzIHsgdGl0bGU/OiBzdHJpbmc7IGJvZHk/OiBzdHJpbmc7IHVybD86IHN0cmluZyB9O1xuICAgIGlmICghdGl0bGUgJiYgIWJvZHkpIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiAnTWlzc2luZyB0aXRsZSBvciBib2R5JyB9KTtcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ25vdGlmaWNhdGlvbnMnKVxuICAgICAgLmluc2VydCh7IHVzZXJfaWQ6IHVzZXIuaWQsIHRpdGxlLCBib2R5LCB1cmwgfSlcbiAgICAgIC5zZWxlY3QoJ2lkLCB0aXRsZSwgYm9keSwgdXJsLCByZWFkX2F0LCBjcmVhdGVkX2F0JylcbiAgICAgIC5zaW5nbGUoKTtcbiAgICBpZiAoZXJyb3IpIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiBlcnJvci5tZXNzYWdlIH0pO1xuICAgIHJldHVybiByZXMuc3RhdHVzKDIwMSkuanNvbih7IG5vdGlmaWNhdGlvbjogZGF0YSB9KTtcbiAgfVxuXG4gIHJlcy5zZXRIZWFkZXIoJ0FsbG93JywgJ0dFVCxQT1NUJyk7XG4gIHJldHVybiByZXMuc3RhdHVzKDQwNSkuZW5kKCdNZXRob2QgTm90IEFsbG93ZWQnKTtcbn1cbiJdLCJuYW1lcyI6WyJjcmVhdGVTdXBhYmFzZVNlcnZlckNsaWVudCIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJzdXBhYmFzZSIsImRhdGEiLCJ1c2VyIiwiYXV0aCIsImdldFVzZXIiLCJzdGF0dXMiLCJqc29uIiwiZXJyb3IiLCJtZXRob2QiLCJmcm9tIiwic2VsZWN0IiwiZXEiLCJpZCIsIm9yZGVyIiwiYXNjZW5kaW5nIiwibWVzc2FnZSIsImxpc3QiLCJsZW5ndGgiLCJ3ZWxjb21lIiwidGl0bGUiLCJib2R5IiwidXJsIiwicmVhZF9hdCIsImNyZWF0ZWRfYXQiLCJEYXRlIiwidG9JU09TdHJpbmciLCJub3RpZmljYXRpb25zIiwidW5yZWFkIiwiZmlsdGVyIiwibiIsImluc2VydCIsInVzZXJfaWQiLCJzaW5nbGUiLCJub3RpZmljYXRpb24iLCJzZXRIZWFkZXIiLCJlbmQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./pages/api/notifications/index.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fnotifications&preferredRegion=&absolutePagePath=.%2Fpages%2Fapi%2Fnotifications%2Findex.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();

File: ./tests/api/notifications-default.test.ts
import { strict as assert } from 'node:assert';
import { resolve } from 'node:path';

// Stub env module
const envPath = resolve(__dirname, '../../lib/env.ts');
require.cache[envPath] = { exports: { env: {} } };

// Mock Supabase server client
const supabaseClient = {
  auth: {
    getUser: async () => ({ data: { user: { id: 'user1' } } }),
  },
  from: (table: string) => {
    if (table === 'notifications') {
      return {
        select: () => ({
          eq: () => ({
            order: async () => ({ data: [], error: null }),
          }),
        }),
      } as any;
    }
    return {} as any;
  },
};
require.cache[require.resolve('../../lib/supabaseServer')] = {
  exports: { createSupabaseServerClient: () => supabaseClient },
};

const handler = require('../../pages/api/notifications/index').default;

(async () => {
  const res = {
    status(code: number) {
      this.statusCode = code;
      return this;
    },
    json(data: any) {
      this.body = data;
      return data;
    },
    statusCode: 200 as number | undefined,
    body: undefined as any,
  };

  await handler({ method: 'GET', headers: {} } as any, res as any);
  assert.equal(res.statusCode, 200);
  assert.ok(Array.isArray(res.body.notifications));
  assert.equal(res.body.notifications[0].title, 'Welcome to GramorX!');
  assert.equal(res.body.unread, 1);
  console.log('notifications API default message tested');
})();


File: ./supabase/migrations/20250913_notification_settings.sql
-- Add notification settings and phone to user_profiles
alter table public.user_profiles
  add column if not exists phone text,
  add column if not exists notification_channels text[] default '{}'::text[],
  add column if not exists quiet_hours_start time,
  add column if not exists quiet_hours_end time;


File: ./supabase/migrations/20250922_notifications.sql
create table if not exists public.notifications (
  id uuid primary key default uuid_generate_v4(),
  user_id uuid references auth.users(id) on delete cascade,
  message text not null,
  url text,
  read boolean default false,
  created_at timestamptz default now()
);

alter table public.notifications enable row level security;

create policy "Users manage own notifications"
  on public.notifications
  for all
  using (auth.uid() = user_id)
  with check (auth.uid() = user_id);
